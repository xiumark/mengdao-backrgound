var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r};!function(r){!function(e){function t(e){if(window.location){var t=location.search;if(""==t)return"";for(var r=(t=t.slice(1)).split("&"),i=r.length,n=0;n<i;n++){var a=r[n].split("=");if(a[0]==e)return a[1]}}return""}(r.web||(r.web={})).getOption=t,r.getOption=t}()}(egret||(egret={})),function(e){var t,r;t=e.web||(e.web={}),r=function(){function e(){}return e.call=function(e,t){},e.addCallback=function(e,t){},e}(),t.WebExternalInterface=r,__reflect(r.prototype,"egret.web.WebExternalInterface",["egret.ExternalInterface"]),navigator.userAgent.toLowerCase().indexOf("egretnative")<0&&(e.ExternalInterface=r)}(egret||(egret={})),function(a){var e,o,t;e=a.web||(a.web={}),o={},t=function(){function e(){}return e.call=function(e,t){var r={};r.functionName=e,r.value=t,egret_native.sendInfoToPlugin(JSON.stringify(r))},e.addCallback=function(e,t){o[e]=t},e}(),e.NativeExternalInterface=t,__reflect(t.prototype,"egret.web.NativeExternalInterface",["egret.ExternalInterface"]),0<=navigator.userAgent.toLowerCase().indexOf("egretnative")&&(a.ExternalInterface=t,egret_native.receivedPluginInfo=function(e){var t=JSON.parse(e),r=t.functionName,i=o[r];if(i){var n=t.value;i.call(null,n)}else a.$warn(1050,r)})}(egret||(egret={})),function(i){var e,n,t;e=i.web||(i.web={}),n={},t=function(){function e(){}return e.call=function(e,t){__global.ExternalInterface.call(e,t)},e.addCallback=function(e,t){n[e]=t},e.invokeCallback=function(e,t){var r=n[e];r?r.call(null,t):i.$warn(1050,e)},e}(),e.WebViewExternalInterface=t,__reflect(t.prototype,"egret.web.WebViewExternalInterface",["egret.ExternalInterface"]),0<=navigator.userAgent.toLowerCase().indexOf("egretwebview")&&(i.ExternalInterface=t)}(egret||(egret={})),function(c){var n,e;n=c.web||(c.web={}),e=function(t){function s(){var e=t.call(this)||this;return e.loaded=!1,e}return __extends(s,t),Object.defineProperty(s.prototype,"length",{get:function(){if(this.originAudio)return this.originAudio.duration;throw new Error("sound not loaded!")},enumerable:!0,configurable:!0}),s.prototype.load=function(e){var t=this;(this.url=e)||c.$error(3002);var r=new Audio(e);r.addEventListener("canplaythrough",n),r.addEventListener("error",a);var i=navigator.userAgent.toLowerCase();function n(){s.$recycle(this.url,r),o(),0<=i.indexOf("firefox")&&(r.pause(),r.muted=!1),t.loaded=!0,t.dispatchEventWith(c.Event.COMPLETE)}function a(){o(),t.dispatchEventWith(c.IOErrorEvent.IO_ERROR)}function o(){r.removeEventListener("canplaythrough",n),r.removeEventListener("error",a),0<=i.indexOf("edge")&&document.body.removeChild(r)}0<=i.indexOf("firefox")&&(r.autoplay=!0,r.muted=!0),0<=i.indexOf("edge")&&document.body.appendChild(r),r.load(),this.originAudio=r,s.clearAudios[this.url]&&delete s.clearAudios[this.url]},s.prototype.play=function(e,t){e=+e||0,t=+t||0,0==this.loaded&&c.$error(1049);var r=s.$pop(this.url);null==r&&(r=this.originAudio.cloneNode()),r.autoplay=!0;var i=new n.HtmlSoundChannel(r);return i.$url=this.url,i.$loops=t,i.$startTime=e,i.$play(),c.sys.$pushSoundChannel(i),i},s.prototype.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),s.$clear(this.url)},s.$clear=function(e){s.clearAudios[e]=!0;var t=s.audios[e];t&&(t.length=0)},s.$pop=function(e){var t=s.audios[e];return t&&0<t.length?t.pop():null},s.$recycle=function(e,t){if(!s.clearAudios[e]){var r=s.audios[e];null==s.audios[e]&&(r=s.audios[e]=[]),r.push(t)}},s.MUSIC="music",s.EFFECT="effect",s.audios={},s.clearAudios={},s}(c.EventDispatcher),n.HtmlSound=e,__reflect(e.prototype,"egret.web.HtmlSound",["egret.Sound"])}(egret||(egret={})),function(i){var n,e;n=i.web||(i.web={}),e=function(r){function e(e){var t=r.call(this)||this;return t.$startTime=0,t.audio=null,t.isStopped=!1,t.canPlay=function(){t.audio.removeEventListener("canplay",t.canPlay);try{t.audio.currentTime=t.$startTime}catch(e){}finally{t.audio.play()}},t.onPlayEnd=function(){if(1==t.$loops)return t.stop(),void t.dispatchEventWith(i.Event.SOUND_COMPLETE);0<t.$loops&&t.$loops--,t.$play()},t._volume=1,e.addEventListener("ended",t.onPlayEnd),t.audio=e,t}return __extends(e,r),e.prototype.$play=function(){if(this.isStopped)i.$error(1036);else{try{this.audio.volume=this._volume,this.audio.currentTime=this.$startTime}catch(e){return void this.audio.addEventListener("canplay",this.canPlay)}this.audio.play()}},e.prototype.stop=function(){if(this.audio){this.isStopped||i.sys.$popSoundChannel(this),this.isStopped=!0;var e=this.audio;e.removeEventListener("ended",this.onPlayEnd),e.removeEventListener("canplay",this.canPlay),e.volume=0,this._volume=0,this.audio=null;var t=this.$url;window.setTimeout(function(){e.pause(),n.HtmlSound.$recycle(t,e)},200)}},Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){this.isStopped?i.$error(1036):(this._volume=e,this.audio&&(this.audio.volume=e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.audio?this.audio.currentTime:0},enumerable:!0,configurable:!0}),e}(i.EventDispatcher),n.HtmlSoundChannel=e,__reflect(e.prototype,"egret.web.HtmlSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(egret||(egret={})),function(o){!function(i){var a=function(){function r(){}return r.decodeAudios=function(){if(!(r.decodeArr.length<=0||r.isDecoding)){r.isDecoding=!0;var t=r.decodeArr.shift();r.ctx.decodeAudioData(t.buffer,function(e){t.self.audioBuffer=e,t.success&&t.success(),r.isDecoding=!1,r.decodeAudios()},function(){t.fail&&t.fail(),r.isDecoding=!1,r.decodeAudios()})}},r.decodeArr=[],r.isDecoding=!1,r}();i.WebAudioDecode=a,__reflect(a.prototype,"egret.web.WebAudioDecode");var e=function(t){function e(){var e=t.call(this)||this;return e.loaded=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"length",{get:function(){if(this.audioBuffer)return this.audioBuffer.duration;throw new Error("sound not loaded!")},enumerable:!0,configurable:!0}),e.prototype.load=function(e){var t=this;(this.url=e)||o.$error(3002);var r=new XMLHttpRequest;function i(){t.loaded=!0,t.dispatchEventWith(o.Event.COMPLETE)}function n(){t.dispatchEventWith(o.IOErrorEvent.IO_ERROR)}r.open("GET",e,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){4==r.readyState&&(400<=r.status||0==r.status?t.dispatchEventWith(o.IOErrorEvent.IO_ERROR):(a.decodeArr.push({buffer:r.response,success:i,fail:n,self:t,url:t.url}),a.decodeAudios()))},r.send()},e.prototype.play=function(e,t){e=+e||0,t=+t||0,0==this.loaded&&o.$error(1049);var r=new i.WebAudioSoundChannel;return r.$url=this.url,r.$loops=t,r.$audioBuffer=this.audioBuffer,r.$startTime=e,r.$play(),o.sys.$pushSoundChannel(r),r},e.prototype.close=function(){},e.MUSIC="music",e.EFFECT="effect",e}(o.EventDispatcher);i.WebAudioSound=e,__reflect(e.prototype,"egret.web.WebAudioSound",["egret.Sound"])}(o.web||(o.web={}))}(egret||(egret={})),function(i){var r,e;r=i.web||(i.web={}),e=function(t){function e(){var e=t.call(this)||this;return e.$startTime=0,e.bufferSource=null,e.context=r.WebAudioDecode.ctx,e.isStopped=!1,e._currentTime=0,e._volume=1,e.onPlayEnd=function(){if(1==e.$loops)return e.stop(),void e.dispatchEventWith(i.Event.SOUND_COMPLETE);0<e.$loops&&e.$loops--,e.$play()},e._startTime=0,e.context.createGain?e.gain=e.context.createGain():e.gain=e.context.createGainNode(),e}return __extends(e,t),e.prototype.$play=function(){if(this.isStopped)i.$error(1036);else{this.bufferSource&&(this.bufferSource.onended=null,this.bufferSource=null);var e=this.context,t=this.gain,r=e.createBufferSource();(this.bufferSource=r).buffer=this.$audioBuffer,r.connect(t),t.connect(e.destination),r.onended=this.onPlayEnd,this._startTime=Date.now(),this.gain.gain.value=this._volume,r.start(0,this.$startTime),this._currentTime=0}},e.prototype.stop=function(){if(this.bufferSource){var e=this.bufferSource;e.stop?e.stop(0):e.noteOff(0),e.onended=null,e.disconnect(),this.bufferSource=null,this.$audioBuffer=null}this.isStopped||i.sys.$popSoundChannel(this),this.isStopped=!0},Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){this.isStopped?i.$error(1036):(this._volume=e,this.gain.gain.value=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.bufferSource?(Date.now()-this._startTime)/1e3+this.$startTime:0},enumerable:!0,configurable:!0}),e}(i.EventDispatcher),r.WebAudioSoundChannel=e,__reflect(e.prototype,"egret.web.WebAudioSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(egret||(egret={})),function(a){var e,t;e=a.web||(a.web={}),t=function(i){function e(e,t){void 0===t&&(t=!0);var r=i.call(this)||this;return r.loaded=!1,r.closed=!1,r.heightSet=NaN,r.widthSet=NaN,r.waiting=!1,r.userPause=!1,r.userPlay=!1,r.isPlayed=!1,r.screenChanged=function(e){var t=document.fullscreenEnabled||document.webkitIsFullScreen;t||(r.checkFullScreen(!1),a.Capabilities.isMobile||(r._fullscreen=t))},r._fullscreen=!0,r.onVideoLoaded=function(){r.video.removeEventListener("canplay",r.onVideoLoaded);var e=r.video;r.loaded=!0,r.posterData&&(r.posterData.width=r.getPlayWidth(),r.posterData.height=r.getPlayHeight()),e.width=e.videoWidth,e.height=e.videoHeight,window.setTimeout(function(){r.dispatchEventWith(a.Event.COMPLETE)},200)},r.$renderNode=new a.sys.BitmapNode,r.src=e,r.once(a.Event.ADDED_TO_STAGE,r.loadPoster,r),e&&r.load(),r}return __extends(e,i),e.prototype.createNativeDisplayObject=function(){this.$nativeDisplayObject=new egret_native.NativeDisplayObject(1)},e.prototype.load=function(e,t){var r=this;if(void 0===t&&(t=!0),e=e||this.src,(this.src=e)||a.$error(3002),!this.video||this.video.src!=e){var i;!this.video||a.Capabilities.isMobile?(i=document.createElement("video"),(this.video=i).controls=null):i=this.video,i.src=e,i.setAttribute("autoplay","autoplay"),i.setAttribute("webkit-playsinline","true"),i.addEventListener("canplay",this.onVideoLoaded),i.addEventListener("error",function(){return r.onVideoError()}),i.addEventListener("ended",function(){return r.onVideoEnded()});var n=!1;i.addEventListener("canplay",function(){r.waiting=!1,n?r.userPause?r.pause():r.userPlay&&r.play():(n=!0,i.pause())}),i.addEventListener("waiting",function(){r.waiting=!0}),i.load(),this.videoPlay(),i.style.position="absolute",i.style.top="0px",i.style.zIndex="-88888",i.style.left="0px",i.height=1,i.width=1}},e.prototype.play=function(t,r){var i=this;if(void 0===r&&(r=!1),0==this.loaded)return this.load(this.src),void this.once(a.Event.COMPLETE,function(e){return i.play(t,r)},this);this.isPlayed=!0;var e=this.video;null!=t&&(e.currentTime=+t||0),e.loop=!!r,a.Capabilities.isMobile?e.style.zIndex="-88888":e.style.zIndex="9999",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.height=e.videoHeight,e.width=e.videoWidth,"Windows PC"!=a.Capabilities.os&&"Mac OS"!=a.Capabilities.os&&window.setTimeout(function(){e.width=0},1e3),this.checkFullScreen(this._fullscreen)},e.prototype.videoPlay=function(){this.userPause=!1,this.waiting?this.userPlay=!0:(this.userPlay=!1,this.video.play())},e.prototype.checkFullScreen=function(e){var t=this.video;if(e)null==t.parentElement&&(t.removeAttribute("webkit-playsinline"),document.body.appendChild(t)),a.stopTick(this.markDirty,this),this.goFullscreen();else if(null!=t.parentElement&&t.parentElement.removeChild(t),t.setAttribute("webkit-playsinline","true"),this.setFullScreenMonitor(!1),a.startTick(this.markDirty,this),a.Capabilities.isMobile)return this.video.currentTime=0,void this.onVideoEnded();this.videoPlay()},e.prototype.goFullscreen=function(){var e,t=this.video;return(t[e=a.web.getPrefixStyleName("requestFullscreen",t)]||t[e=a.web.getPrefixStyleName("requestFullScreen",t)])&&(t.removeAttribute("webkit-playsinline"),t[e](),this.setFullScreenMonitor(!0)),!0},e.prototype.setFullScreenMonitor=function(e){var t=this.video;e?(t.addEventListener("mozfullscreenchange",this.screenChanged),t.addEventListener("webkitfullscreenchange",this.screenChanged),t.addEventListener("mozfullscreenerror",this.screenError),t.addEventListener("webkitfullscreenerror",this.screenError)):(t.removeEventListener("mozfullscreenchange",this.screenChanged),t.removeEventListener("webkitfullscreenchange",this.screenChanged),t.removeEventListener("mozfullscreenerror",this.screenError),t.removeEventListener("webkitfullscreenerror",this.screenError))},e.prototype.screenError=function(){a.$error(3014)},e.prototype.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.oCancelFullScreen?document.oCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},e.prototype.onVideoEnded=function(){this.pause(),this.isPlayed=!1,this.dispatchEventWith(a.Event.ENDED)},e.prototype.onVideoError=function(){this.dispatchEventWith(a.IOErrorEvent.IO_ERROR)},e.prototype.close=function(){var e=this;this.closed=!0,this.video.removeEventListener("canplay",this.onVideoLoaded),this.video.removeEventListener("error",function(){return e.onVideoError()}),this.video.removeEventListener("ended",function(){return e.onVideoEnded()}),this.pause(),0==this.loaded&&this.video&&(this.video.src=""),this.video&&this.video.parentElement&&(this.video.parentElement.removeChild(this.video),this.video=null),this.loaded=!1},e.prototype.pause=function(){this.userPlay=!1,this.waiting?this.userPause=!0:(this.userPause=!1,this.video.pause(),a.stopTick(this.markDirty,this))},Object.defineProperty(e.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(e){this.video&&(this.video.volume=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.video?this.video.currentTime:0},set:function(e){this.video&&(this.video.currentTime=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullscreen",{get:function(){return this._fullscreen},set:function(e){a.Capabilities.isMobile||(this._fullscreen=!!e,this.video&&0==this.video.paused&&this.checkFullScreen(this._fullscreen))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bitmapData",{get:function(){return this.video&&this.loaded?(this._bitmapData||(this.video.width=this.video.videoWidth,this.video.height=this.video.videoHeight,this._bitmapData=new a.BitmapData(this.video),this._bitmapData.$deleteSource=!1),this._bitmapData):null},enumerable:!0,configurable:!0}),e.prototype.loadPoster=function(){var r=this,e=this.poster;if(e){var i=new a.ImageLoader;i.once(a.Event.COMPLETE,function(e){i.data;if(r.posterData=i.data,r.$renderDirty=!0,r.posterData.width=r.getPlayWidth(),r.posterData.height=r.getPlayHeight(),a.nativeRender){var t=new a.Texture;t._setBitmapData(r.posterData),r.$nativeDisplayObject.setBitmapData(t)}},this),i.load(e)}},e.prototype.$measureContentBounds=function(e){var t=this.bitmapData,r=this.posterData;t?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):r?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):e.setEmpty()},e.prototype.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:NaN:this.widthSet},e.prototype.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:NaN:this.heightSet},e.prototype.$updateRenderNode=function(){var e=this.$renderNode,t=this.bitmapData,r=this.posterData,i=this.getPlayWidth(),n=this.getPlayHeight();this.isPlayed&&!a.Capabilities.isMobile||!r?this.isPlayed&&t&&(e.image=t,e.imageWidth=t.width,e.imageHeight=t.height,a.WebGLUtils.deleteWebGLTexture(t.webGLTexture),t.webGLTexture=null,e.drawImage(0,0,t.width,t.height,0,0,i,n)):(e.image=r,e.imageWidth=i,e.imageHeight=n,e.drawImage(0,0,r.width,r.height,0,0,i,n))},e.prototype.markDirty=function(){return this.$renderDirty=!0},e.prototype.$setHeight=function(e){if(this.heightSet=e,this.paused){var t=this;this.$renderDirty=!0,window.setTimeout(function(){t.$renderDirty=!1},200)}i.prototype.$setHeight.call(this,e)},e.prototype.$setWidth=function(e){if(this.widthSet=e,this.paused){var t=this;this.$renderDirty=!0,window.setTimeout(function(){t.$renderDirty=!1},200)}i.prototype.$setWidth.call(this,e)},Object.defineProperty(e.prototype,"paused",{get:function(){return!this.video||this.video.paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){if(this.video)return this.video.duration;throw new Error("Video not loaded!")},enumerable:!0,configurable:!0}),e}(a.DisplayObject),e.WebVideo=t,__reflect(t.prototype,"egret.web.WebVideo",["egret.Video","egret.DisplayObject"]),a.Video=t}(egret||(egret={})),function(n){var e,t;e=n.web||(n.web={}),t=function(t){function e(){var e=t.call(this)||this;return e._url="",e._method="",e}return __extends(e,t),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr?null!=this._xhr.response?this._xhr.response:"text"==this._responseType?this._xhr.responseText:"arraybuffer"==this._responseType&&/msie 9.0/i.test(navigator.userAgent)?window.convertResponseBodyToText(this._xhr.responseBody):"document"==this._responseType?this._xhr.responseXML:null:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._responseType},set:function(e){this._responseType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withCredentials",{get:function(){return this._withCredentials},set:function(e){this._withCredentials=e},enumerable:!0,configurable:!0}),e.prototype.getXHR=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},e.prototype.open=function(e,t){void 0===t&&(t="GET"),this._url=e,this._method=t,this._xhr&&(this._xhr.abort(),this._xhr=null),this._xhr=this.getXHR(),this._xhr.onreadystatechange=this.onReadyStateChange.bind(this),this._xhr.onprogress=this.updateProgress.bind(this),this._xhr.open(this._method,this._url,!0)},e.prototype.send=function(e){if(null!=this._responseType&&(this._xhr.responseType=this._responseType),null!=this._withCredentials&&(this._xhr.withCredentials=this._withCredentials),this.headerObj)for(var t in this.headerObj)this._xhr.setRequestHeader(t,this.headerObj[t]);this._xhr.send(e)},e.prototype.abort=function(){this._xhr&&this._xhr.abort()},e.prototype.getAllResponseHeaders=function(){if(!this._xhr)return null;var e=this._xhr.getAllResponseHeaders();return e||""},e.prototype.setRequestHeader=function(e,t){this.headerObj||(this.headerObj={}),this.headerObj[e]=t},e.prototype.getResponseHeader=function(e){if(!this._xhr)return null;var t=this._xhr.getResponseHeader(e);return t||""},e.prototype.onReadyStateChange=function(){var e=this._xhr;if(4==e.readyState){var t=400<=e.status||0==e.status,r=this._url,i=this;window.setTimeout(function(){t?(i.hasEventListener(n.IOErrorEvent.IO_ERROR)||n.$error(1011,r),i.dispatchEventWith(n.IOErrorEvent.IO_ERROR)):i.dispatchEventWith(n.Event.COMPLETE)},0)}},e.prototype.updateProgress=function(e){e.lengthComputable&&n.ProgressEvent.dispatchProgressEvent(this,n.ProgressEvent.PROGRESS,e.loaded,e.total)},e}(n.EventDispatcher),e.WebHttpRequest=t,__reflect(t.prototype,"egret.web.WebHttpRequest",["egret.HttpRequest"]),n.HttpRequest=t}(egret||(egret={})),function(i){var n,a,e;n=i.web||(i.web={}),a=window.URL||window.webkitURL,e=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e._crossOrigin=null,e._hasCrossOriginSet=!1,e.currentImage=null,e.request=null,e}return __extends(r,t),Object.defineProperty(r.prototype,"crossOrigin",{get:function(){return this._crossOrigin},set:function(e){this._hasCrossOriginSet=!0,this._crossOrigin=e},enumerable:!0,configurable:!0}),r.prototype.load=function(e){if(n.Html5Capatibility._canUseBlob&&0!=e.indexOf("wxLocalResource:")&&0!=e.indexOf("data:")&&0!=e.indexOf("http:")&&0!=e.indexOf("https:")){var t=this.request;t||((t=this.request=new i.web.WebHttpRequest).addEventListener(i.Event.COMPLETE,this.onBlobLoaded,this),t.addEventListener(i.IOErrorEvent.IO_ERROR,this.onBlobError,this),t.responseType="blob"),this.currentURL=e,t.open(e),t.send()}else this.loadImage(e)},r.prototype.onBlobLoaded=function(e){var t=this.request.response;this.request=void 0,this.loadImage(a.createObjectURL(t))},r.prototype.onBlobError=function(e){this.dispatchIOError(this.currentURL),this.request=void 0},r.prototype.loadImage=function(e){var t=new Image;this.data=null,this.currentImage=t,this._hasCrossOriginSet?this._crossOrigin&&(t.crossOrigin=this._crossOrigin):r.crossOrigin&&(t.crossOrigin=r.crossOrigin),t.onload=this.onImageComplete.bind(this),t.onerror=this.onLoadError.bind(this),t.src=e},r.prototype.onImageComplete=function(e){var t=this.getImage(e);if(t){this.data=new i.BitmapData(t);var r=this;window.setTimeout(function(){r.dispatchEventWith(i.Event.COMPLETE)},0)}},r.prototype.onLoadError=function(e){var t=this.getImage(e);t&&this.dispatchIOError(t.src)},r.prototype.dispatchIOError=function(e){var t=this;window.setTimeout(function(){t.hasEventListener(i.IOErrorEvent.IO_ERROR)||i.$error(1011,e),t.dispatchEventWith(i.IOErrorEvent.IO_ERROR)},0)},r.prototype.getImage=function(e){var t=e.target;if(0==t.src.indexOf("blob:"))try{a.revokeObjectURL(t.src)}catch(e){i.$warn(1037)}return t.onerror=null,t.onload=null,this.currentImage!==t?null:(this.currentImage=null,t)},r.crossOrigin=null,r}(i.EventDispatcher),n.WebImageLoader=e,__reflect(e.prototype,"egret.web.WebImageLoader",["egret.ImageLoader"]),i.ImageLoader=e}(egret||(egret={})),function(h){var e,t;e=h.web||(h.web={}),t=function(t){function e(){var e=t.call(this)||this;return e._isNeedShow=!1,e.inputElement=null,e.inputDiv=null,e._gscaleX=0,e._gscaleY=0,e.textValue="",e.colorValue=16777215,e._styleInfoes={},e}return __extends(e,t),e.prototype.$setTextField=function(e){return this.$textfield=e,!0},e.prototype.$addToStage=function(){this.htmlInput=h.web.$getTextAdapter(this.$textfield)},e.prototype._initElement=function(){var e=this.$textfield.localToGlobal(0,0),t=e.x,r=e.y,i=this.htmlInput.$scaleX,n=this.htmlInput.$scaleY;this.inputDiv.style.left=t*i+"px",this.inputDiv.style.top=r*n+"px",this.$textfield.multiline&&this.$textfield.height>this.$textfield.size?(this.inputDiv.style.top=r*n+"px",this.inputElement.style.top=-this.$textfield.lineSpacing/2*n+"px"):(this.inputDiv.style.top=r*n+"px",this.inputElement.style.top="0px");for(var a=this.$textfield,o=1,s=1,c=0;a.parent;)o*=a.scaleX,s*=a.scaleY,c+=a.rotation,a=a.parent;var l=h.web.getPrefixStyleName("transform");this.inputDiv.style[l]="rotate("+c+"deg)",this._gscaleX=i*o,this._gscaleY=n*s},e.prototype.$show=function(){this.htmlInput.isCurrentStageText(this)?this.inputElement.onblur=null:(this.inputElement=this.htmlInput.getInputElement(this),this.$textfield.multiline?this.inputElement.type="text":this.inputElement.type=this.$textfield.inputType,this.inputDiv=this.htmlInput._inputDIV),this.htmlInput._needShow=!0,this._isNeedShow=!0,this._initElement()},e.prototype.onBlurHandler=function(){this.htmlInput.clearInputElement(),window.scrollTo(0,0)},e.prototype.executeShow=function(){this.inputElement.value=this.$getText(),null==this.inputElement.onblur&&(this.inputElement.onblur=this.onBlurHandler.bind(this)),this.$resetStageText(),0<this.$textfield.maxChars?this.inputElement.setAttribute("maxlength",this.$textfield.maxChars):this.inputElement.removeAttribute("maxlength"),this.inputElement.selectionStart=this.inputElement.value.length,this.inputElement.selectionEnd=this.inputElement.value.length,this.inputElement.focus()},e.prototype.$hide=function(){this.htmlInput&&this.htmlInput.disconnectStageText(this)},e.prototype.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},e.prototype.$setText=function(e){return this.textValue=e,this.resetText(),!0},e.prototype.resetText=function(){this.inputElement&&(this.inputElement.value=this.textValue)},e.prototype.$setColor=function(e){return this.colorValue=e,this.resetColor(),!0},e.prototype.resetColor=function(){this.inputElement&&this.setElementStyle("color",h.toColorString(this.colorValue))},e.prototype.$onBlur=function(){},e.prototype._onInput=function(){var e=this;window.setTimeout(function(){e.inputElement&&e.inputElement.selectionStart==e.inputElement.selectionEnd&&(e.textValue=e.inputElement.value,h.Event.dispatchEvent(e,"updateText",!1))},0)},e.prototype.setAreaHeight=function(){var e=this.$textfield;if(e.multiline){var t=h.TextFieldUtils.$getTextHeight(e);if(e.height<=e.size)this.setElementStyle("height",e.size*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",e.size*this._gscaleY+"px");else if(e.height<t)this.setElementStyle("height",e.height*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",(e.size+e.lineSpacing)*this._gscaleY+"px");else{this.setElementStyle("height",(t+e.lineSpacing)*this._gscaleY+"px");var r=(e.height-t)*this._gscaleY,i=r*h.TextFieldUtils.$getValign(e),n=r-i;this.setElementStyle("padding",i+"px 0px "+n+"px 0px"),this.setElementStyle("lineHeight",(e.size+e.lineSpacing)*this._gscaleY+"px")}}},e.prototype._onClickHandler=function(e){this._isNeedShow&&(e.stopImmediatePropagation(),this._isNeedShow=!1,this.executeShow(),this.dispatchEvent(new h.Event("focus")))},e.prototype._onDisconnect=function(){this.inputElement=null,this.dispatchEvent(new h.Event("blur"))},e.prototype.setElementStyle=function(e,t){this.inputElement&&this._styleInfoes[e]!=t&&(this.inputElement.style[e]=t)},e.prototype.$removeFromStage=function(){this.inputElement&&this.htmlInput.disconnectStageText(this)},e.prototype.$resetStageText=function(){if(this.inputElement){var e=this.$textfield;this.setElementStyle("fontFamily",e.fontFamily),this.setElementStyle("fontStyle",e.italic?"italic":"normal"),this.setElementStyle("fontWeight",e.bold?"bold":"normal"),this.setElementStyle("textAlign",e.textAlign),this.setElementStyle("fontSize",e.size*this._gscaleY+"px"),this.setElementStyle("color",h.toColorString(e.textColor));var t=void 0;if(e.stage?(t=e.localToGlobal(0,0).x,t=Math.min(e.width,e.stage.stageWidth-t)):t=e.width,this.setElementStyle("width",t*this._gscaleX+"px"),this.setElementStyle("verticalAlign",e.verticalAlign),e.multiline)this.setAreaHeight();else if(this.setElementStyle("lineHeight",e.size*this._gscaleY+"px"),e.height<e.size){this.setElementStyle("height",e.size*this._gscaleY+"px");var r=e.size/2*this._gscaleY;this.setElementStyle("padding","0px 0px "+r+"px 0px")}else{this.setElementStyle("height",e.size*this._gscaleY+"px");var i=(e.height-e.size)*this._gscaleY,n=i*h.TextFieldUtils.$getValign(e);(r=i-n)<e.size/2*this._gscaleY&&(r=e.size/2*this._gscaleY),this.setElementStyle("padding",n+"px 0px "+r+"px 0px")}this.inputDiv.style.clip="rect(0px "+e.width*this._gscaleX+"px "+e.height*this._gscaleY+"px 0px)",this.inputDiv.style.height=e.height*this._gscaleY+"px",this.inputDiv.style.width=t*this._gscaleX+"px"}},e}(h.EventDispatcher),e.HTML5StageText=t,__reflect(t.prototype,"egret.web.HTML5StageText",["egret.StageText"]),h.StageText=t}(egret||(egret={})),function(n){var e,t;e=n.web||(n.web={}),t=function(){function e(){this._needShow=!1,this.$scaleX=1,this.$scaleY=1}return e.prototype.isInputOn=function(){return null!=this._stageText},e.prototype.isCurrentStageText=function(e){return this._stageText==e},e.prototype.initValue=function(e){e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.border="none",e.style.padding="0"},e.prototype.$updateSize=function(){if(this.canvas){this.$scaleX=n.sys.DisplayList.$canvasScaleX,this.$scaleY=n.sys.DisplayList.$canvasScaleY,this.StageDelegateDiv.style.left=this.canvas.style.left,this.StageDelegateDiv.style.top=this.canvas.style.top;var e=n.web.getPrefixStyleName("transform");this.StageDelegateDiv.style[e]=this.canvas.style[e],this.StageDelegateDiv.style[n.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px"}},e.prototype._initStageDelegateDiv=function(e,t){this.canvas=t;var r,i=this;r||(r=document.createElement("div"),(this.StageDelegateDiv=r).id="StageDelegateDiv",e.appendChild(r),i.initValue(r),i._inputDIV=document.createElement("div"),i.initValue(i._inputDIV),i._inputDIV.style.width="0px",i._inputDIV.style.height="0px",i._inputDIV.style.left="0px",i._inputDIV.style.top="-100px",i._inputDIV.style[n.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px",r.appendChild(i._inputDIV),this.canvas.addEventListener("click",function(e){i._needShow?(i._needShow=!1,i._stageText._onClickHandler(e),i.show()):i._inputElement&&(i.clearInputElement(),i._inputElement.blur(),i._inputElement=null)}),i.initInputElement(!0),i.initInputElement(!1))},e.prototype.initInputElement=function(e){var t,r=this;e?((t=document.createElement("textarea")).style.resize="none",(r._multiElement=t).id="egretTextarea"):(t=document.createElement("input"),(r._simpleElement=t).id="egretInput"),t.type="text",r._inputDIV.appendChild(t),t.setAttribute("tabindex","-1"),t.style.width="1px",t.style.height="12px",r.initValue(t),t.style.outline="thin",t.style.background="none",t.style.overflow="hidden",t.style.wordBreak="break-all",t.style.opacity=0,t.oninput=function(){r._stageText&&r._stageText._onInput()}},e.prototype.show=function(){var e=this._inputElement;n.$callAsync(function(){e.style.opacity=1},this)},e.prototype.disconnectStageText=function(e){null!=this._stageText&&this._stageText!=e||(this.clearInputElement(),this._inputElement&&this._inputElement.blur()),this._needShow=!1},e.prototype.clearInputElement=function(){var e=this;if(e._inputElement){e._inputElement.value="",e._inputElement.onblur=null,e._inputElement.style.width="1px",e._inputElement.style.height="12px",e._inputElement.style.left="0px",e._inputElement.style.top="0px";e._inputElement.style.opacity=0;(e._simpleElement==e._inputElement?e._multiElement:e._simpleElement).style.display="block",e._inputDIV.style.left="0px",e._inputDIV.style.top="-100px",e._inputDIV.style.height="0px",e._inputDIV.style.width="0px"}e._stageText&&(e._stageText._onDisconnect(),e._stageText=null,this.canvas.userTyping=!1)},e.prototype.getInputElement=function(e){var t=this;return t.clearInputElement(),t._stageText=e,this.canvas.userTyping=!0,t._stageText.$textfield.multiline?t._inputElement=t._multiElement:t._inputElement=t._simpleElement,(t._simpleElement==t._inputElement?t._multiElement:t._simpleElement).style.display="none",t._inputElement},e}(),e.HTMLInput=t,__reflect(t.prototype,"egret.web.HTMLInput")}(egret||(egret={})),function(e){var t,a,o,s;t=e.web||(e.web={}),a={},o={},s={},t.$getTextAdapter=function(e){var t=e.stage?e.stage.$hashCode:0,r=a[t],i=o[t],n=s[t];return i&&n&&(delete o[t],delete s[t]),r},t.$cacheTextAdapter=function(e,t,r,i){e._initStageDelegateDiv(r,i),a[t.$hashCode]=e,o[t.$hashCode]=i,s[t.$hashCode]=r}}(egret||(egret={})),function(o){var s;o.web||(o.web={}),s=null,o.sys.measureText=function(e,t,r,i,n){s||((s=o.sys.canvasHitTestBuffer.context).textAlign="left",s.textBaseline="middle");var a="";return n&&(a+="italic "),i&&(a+="bold "),a+=(r||12)+"px ",a+=t||"Arial",s.font=a,s.measureText(e).width}}(egret||(egret={})),function(e){var t,r;t=e.web||(e.web={}),r=function(){function e(e,t,r){this.surface=function(e,t){var r=document.createElement("canvas");isNaN(e)||isNaN(t)||(r.width=e,r.height=t);var i=r.getContext("2d");if(void 0===i.imageSmoothingEnabled){for(var n,a=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],o=a.length-1;0<=o&&void 0===i[n=a[o]];o--);try{Object.defineProperty(i,"imageSmoothingEnabled",{get:function(){return this[n]},set:function(e){this[n]=e}})}catch(e){i.imageSmoothingEnabled=i[n]}}return r}(e,t),this.context=this.surface.getContext("2d"),this.context&&(this.context.$offsetX=0,this.context.$offsetY=0)}return Object.defineProperty(e.prototype,"width",{get:function(){return this.surface.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.surface.height},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t,r){var i=this.surface;if(r){var n=!1;i.width<e&&(i.width=e,n=!0),i.height<t&&(i.height=t,n=!0),n||(this.context.globalCompositeOperation="source-over",this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)}else i.width!=e&&(i.width=e),i.height!=t&&(i.height=t);this.clear()},e.prototype.getPixels=function(e,t,r,i){return void 0===r&&(r=1),void 0===i&&(i=1),this.context.getImageData(e,t,r,i).data},e.prototype.toDataURL=function(e,t){return this.surface.toDataURL(e,t)},e.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.destroy=function(){this.surface.width=this.surface.height=0},e}(),t.CanvasRenderBuffer=r,__reflect(r.prototype,"egret.web.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(egret||(egret={})),function(l){var e,t;e=l.web||(l.web={}),t=function(i){function e(e,t){var r=i.call(this)||this;return r.onTouchBegin=function(e){var t=r.getLocation(e);r.touch.onTouchBegin(t.x,t.y,e.identifier)},r.onMouseMove=function(e){0==e.buttons?r.onTouchEnd(e):r.onTouchMove(e)},r.onTouchMove=function(e){var t=r.getLocation(e);r.touch.onTouchMove(t.x,t.y,e.identifier)},r.onTouchEnd=function(e){var t=r.getLocation(e);r.touch.onTouchEnd(t.x,t.y,e.identifier)},r.scaleX=1,r.scaleY=1,r.rotation=0,r.canvas=t,r.touch=new l.sys.TouchHandler(e),r.addListeners(),r}return __extends(e,i),e.prototype.addListeners=function(){var t=this;window.navigator.msPointerEnabled?(this.canvas.addEventListener("MSPointerDown",function(e){e.identifier=e.pointerId,t.onTouchBegin(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerMove",function(e){e.identifier=e.pointerId,t.onTouchMove(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerUp",function(e){e.identifier=e.pointerId,t.onTouchEnd(e),t.prevent(e)},!1)):(l.Capabilities.isMobile||this.addMouseListener(),this.addTouchListener())},e.prototype.addMouseListener=function(){this.canvas.addEventListener("mousedown",this.onTouchBegin),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseup",this.onTouchEnd)},e.prototype.addTouchListener=function(){var i=this;this.canvas.addEventListener("touchstart",function(e){for(var t=e.changedTouches.length,r=0;r<t;r++)i.onTouchBegin(e.changedTouches[r]);i.prevent(e)},!1),this.canvas.addEventListener("touchmove",function(e){for(var t=e.changedTouches.length,r=0;r<t;r++)i.onTouchMove(e.changedTouches[r]);i.prevent(e)},!1),this.canvas.addEventListener("touchend",function(e){for(var t=e.changedTouches.length,r=0;r<t;r++)i.onTouchEnd(e.changedTouches[r]);i.prevent(e)},!1),this.canvas.addEventListener("touchcancel",function(e){for(var t=e.changedTouches.length,r=0;r<t;r++)i.onTouchEnd(e.changedTouches[r]);i.prevent(e)},!1)},e.prototype.prevent=function(e){e.stopPropagation(),1==e.isScroll||this.canvas.userTyping||e.preventDefault()},e.prototype.getLocation=function(e){e.identifier=+e.identifier||0;var t=document.documentElement,r=this.canvas.getBoundingClientRect(),i=r.left+window.pageXOffset-t.clientLeft,n=r.top+window.pageYOffset-t.clientTop,a=e.pageX-i,o=a,s=e.pageY-n,c=s;return 90==this.rotation?(o=s,c=r.width-a):-90==this.rotation&&(o=r.height-s,c=a),o/=this.scaleX,c/=this.scaleY,l.$TempPoint.setTo(Math.round(o),Math.round(c))},e.prototype.updateScaleMode=function(e,t,r){this.scaleX=e,this.scaleY=t,this.rotation=r},e.prototype.$updateMaxTouches=function(){this.touch.$initMaxTouches()},e}(l.HashObject),e.WebTouchHandler=t,__reflect(t.prototype,"egret.web.WebTouchHandler")}(egret||(egret={})),function(e){(e.web||(e.web={})).WebLifeCycleHandler=function(r){var e,t;window.addEventListener("focus",r.resume,!1),window.addEventListener("blur",r.pause,!1),void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden?(e="webkitHidden",t="webkitvisibilitychange"):void 0!==document.oHidden&&(e="oHidden",t="ovisibilitychange"),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pageshow",r.resume,!1),window.addEventListener("pagehide",r.pause,!1)),e&&t&&document.addEventListener(t,function(){document[e]?r.pause():r.resume()},!1);var i=navigator.userAgent,n=/micromessenger/gi.test(i),a=/mqq/gi.test(i);if((/mobile.*qq/gi.test(i)||n)&&(a=!1),a){var o=window.browser||{};o.execWebFn=o.execWebFn||{},o.execWebFn.postX5GamePlayerMessage=function(e){var t=e.type;"app_enter_background"==t?r.pause():"app_enter_foreground"==t&&r.resume()},window.browser=o}}}(egret||(egret={})),function(c){!function(a){var o=function(){function e(){}return e.WEB_AUDIO=2,e.HTML5_AUDIO=3,e}();a.AudioType=o,__reflect(o.prototype,"egret.web.AudioType");var e=function(e){function n(){return e.call(this)||this}return __extends(n,e),n.$init=function(){var e=navigator.userAgent.toLowerCase();n.ua=e,n._canUseBlob=!1;var t=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(t)try{a.WebAudioDecode.ctx=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}catch(e){t=!1}var r,i=n._audioType;i==o.WEB_AUDIO&&t||i==o.HTML5_AUDIO?(r=!1,n.setAudioType(i)):(r=!0,n.setAudioType(o.HTML5_AUDIO)),0<=e.indexOf("android")?r&&t&&n.setAudioType(o.WEB_AUDIO):(0<=e.indexOf("iphone")||0<=e.indexOf("ipad")||0<=e.indexOf("ipod"))&&7<=n.getIOSVersion()&&(n._canUseBlob=!0,r&&t&&n.setAudioType(o.WEB_AUDIO)),window.URL||window.webkitURL||(n._canUseBlob=!1),0<=e.indexOf("egretnative")&&(n.setAudioType(o.HTML5_AUDIO),n._canUseBlob=!0),c.Sound=n._AudioClass},n.setAudioType=function(e){switch(n._audioType=e){case o.WEB_AUDIO:n._AudioClass=c.web.WebAudioSound;break;case o.HTML5_AUDIO:n._AudioClass=c.web.HtmlSound}},n.getIOSVersion=function(){var e=n.ua.toLowerCase().match(/cpu [^\d]*\d.*like mac os x/);if(!e||0==e.length)return 0;var t=e[0];return parseInt(t.match(/\d+(_\d)*/)[0])||0},n._canUseBlob=!1,n._audioType=0,n.ua="",n}(c.HashObject);a.Html5Capatibility=e,__reflect(e.prototype,"egret.web.Html5Capatibility");var n=null;function s(e,t){if(e in t)return"";e=e.charAt(0).toUpperCase()+e.substring(1,e.length);for(var r=["webkit","ms","Moz","O"],i=0;i<r.length;i++){if(r[i]+e in t)return r[i]}return""}a.getPrefixStyleName=function(e,t){var r="";if(null!=t)r=s(e,t);else{if(null==n){var i=document.createElement("div").style;n=s("transform",i)}r=n}return""==r?e:r+e.charAt(0).toUpperCase()+e.substring(1,e.length)},a.getPrefix=s}(c.web||(c.web={}))}(egret||(egret={})),function(x){!function(d){var f=!1;function p(e){"webgl"==e&&x.WebGLUtils.checkCanUseWebGL()?(x.sys.RenderBuffer=d.WebGLRenderBuffer,x.sys.systemRenderer=new d.WebGLRenderer,x.sys.canvasRenderer=new x.CanvasRenderer,x.sys.customHitTestBuffer=new d.WebGLRenderBuffer(3,3),x.sys.canvasHitTestBuffer=new d.CanvasRenderBuffer(3,3),x.Capabilities.renderMode="webgl"):(x.sys.RenderBuffer=d.CanvasRenderBuffer,x.sys.systemRenderer=new x.CanvasRenderer,x.sys.canvasRenderer=x.sys.systemRenderer,x.sys.customHitTestBuffer=new d.CanvasRenderBuffer(3,3),x.sys.canvasHitTestBuffer=x.sys.customHitTestBuffer,x.Capabilities.renderMode="canvas")}function g(t){var r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;r||(r=function(e){return window.setTimeout(e,1e3/60)}),r(function e(){t.update();r(e)})}window.isNaN=function(e){return(e=+e)!=e},x.runEgret=function(s){if(!f){f=!0,s||(s={});var e=navigator.userAgent.toLowerCase();if(0<=e.indexOf("egretnative")&&-1==e.indexOf("egretwebview")&&(x.Capabilities.runtimeType=x.RuntimeType.RUNTIME2),0<=e.indexOf("egretnative")&&x.nativeRender)egret_native.addModuleCallback(function(){if(d.Html5Capatibility.$init(),"webgl"==s.renderMode){var e=s.antialias;d.WebGLRenderContext.antialias=!!e}var t;x.sys.CanvasRenderBuffer=d.CanvasRenderBuffer,p(s.renderMode),egret_native.nrSetRenderMode(2),t=s.canvasScaleFactor?s.canvasScaleFactor:s.calculateCanvasScaleFactor?s.calculateCanvasScaleFactor(x.sys.canvasHitTestBuffer.context):window.devicePixelRatio,x.sys.DisplayList.$canvasScaleFactor=t,g(x.ticker),s.screenAdapter?x.sys.screenAdapter=s.screenAdapter:x.sys.screenAdapter||(x.sys.screenAdapter=new x.sys.DefaultScreenAdapter);for(var r=document.querySelectorAll(".egret-player"),i=r.length,n=0;n<i;n++){var a=r[n],o=new d.WebPlayer(a,s);a["egret-player"]=o}window.addEventListener("resize",function(){isNaN(v)&&(v=window.setTimeout(y,300))})},null),egret_native.initNativeRender();else{d.Html5Capatibility._audioType=s.audioType,d.Html5Capatibility.$init();var t=s.renderMode;if("webgl"==t){var r=s.antialias;d.WebGLRenderContext.antialias=!!r}x.sys.CanvasRenderBuffer=d.CanvasRenderBuffer,0<=e.indexOf("egretnative")&&"webgl"!=t&&(x.$warn(1051),t="webgl"),p(t);var i=void 0;if(s.canvasScaleFactor)i=s.canvasScaleFactor;else if(s.calculateCanvasScaleFactor)i=s.calculateCanvasScaleFactor(x.sys.canvasHitTestBuffer.context);else{var n=x.sys.canvasHitTestBuffer.context,a=n.backingStorePixelRatio||n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;i=(window.devicePixelRatio||1)/a}x.sys.DisplayList.$canvasScaleFactor=i,g(x.ticker),s.screenAdapter?x.sys.screenAdapter=s.screenAdapter:x.sys.screenAdapter||(x.sys.screenAdapter=new x.sys.DefaultScreenAdapter);for(var o=document.querySelectorAll(".egret-player"),c=o.length,l=0;l<c;l++){var h=o[l],u=new d.WebPlayer(h,s);h["egret-player"]=u}window.addEventListener("resize",function(){isNaN(v)&&(v=window.setTimeout(y,300))})}}},x.updateAllScreens=function(){if(f)for(var e=document.querySelectorAll(".egret-player"),t=e.length,r=0;r<t;r++)e[r]["egret-player"].updateScreenSize()};var v=NaN;function y(){v=NaN,x.updateAllScreens()}}(x.web||(x.web={}))}(egret||(egret={}));var egret,language=navigator.language||navigator.browserLanguage||"en_US";(language=language.replace("-","_"))in egret.$locale_strings&&(egret.$language=language),function(n){var e,t;e=n.web||(n.web={}),t=function(){function i(){}return i.detect=function(){var e=n.Capabilities,t=navigator.userAgent.toLowerCase();e.isMobile=-1!=t.indexOf("mobile")||-1!=t.indexOf("android"),e.isMobile?t.indexOf("windows")<0&&(-1!=t.indexOf("iphone")||-1!=t.indexOf("ipad")||-1!=t.indexOf("ipod"))?e.os="iOS":-1!=t.indexOf("android")&&-1!=t.indexOf("linux")?e.os="Android":-1!=t.indexOf("windows")&&(e.os="Windows Phone"):-1!=t.indexOf("windows nt")?e.os="Windows PC":-1!=t.indexOf("mac os")&&(e.os="Mac OS");var r=(navigator.language||navigator.browserLanguage).toLowerCase().split("-");1<r.length&&(r[1]=r[1].toUpperCase()),e.language=r.join("-"),i.injectUIntFixOnIE9()},i.injectUIntFixOnIE9=function(){if(/msie 9.0/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){document.write("\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\n<script type='text/vbscript' language='VBScript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = \"\"\r\n   End If\r\nEnd Function\r\n<\/script>\r\n\x3c!-- convertResponseBodyToText --\x3e\r\n<script>\r\nlet convertResponseBodyToText = function (binary) {\r\n   let byteMapping = {};\r\n   for ( let i = 0; i < 256; i++ ) {\r\n       for ( let j = 0; j < 256; j++ ) {\r\n           byteMapping[ String.fromCharCode( i + j * 256 ) ] =\r\n           String.fromCharCode(i) + String.fromCharCode(j);\r\n       }\r\n   }\r\n   let rawBytes = IEBinaryToArray_ByteStr(binary);\r\n   let lastChr = IEBinaryToArray_ByteStr_Last(binary);\r\n   return rawBytes.replace(/[\\s\\S]/g,                           function( match ) { return byteMapping[match]; }) + lastChr;\r\n};\r\n<\/script>\r\n")}},i}(),e.WebCapability=t,__reflect(t.prototype,"egret.web.WebCapability"),t.detect()}(egret||(egret={})),function(s){var e,t;e=s.web||(s.web={}),t=function(){function e(e,t,r,i,n){if(this.showPanle=!0,this.fpsHeight=0,this.WIDTH=101,this.HEIGHT=20,this.bgCanvasColor="#18304b",this.fpsFrontColor="#18fefe",this.WIDTH_COST=50,this.cost1Color="#18fefe",this.cost3Color="#ff0000",this.arrFps=[],this.arrCost=[],this.arrLog=[],t||r){"canvas"==s.Capabilities.renderMode?this.renderMode="Canvas":this.renderMode="WebGL",this.panelX=void 0===n.x?0:parseInt(n.x),this.panelY=void 0===n.y?0:parseInt(n.y),this.fontColor=void 0===n.textColor?"#ffffff":n.textColor.replace("0x","#"),this.fontSize=void 0===n.size?12:parseInt(n.size),s.Capabilities.isMobile&&(this.fontSize-=2);var a=document.createElement("div");a.style.position="absolute",a.style.background="rgba(0,0,0,"+n.bgAlpha+")",a.style.left=this.panelX+"px",a.style.top=this.panelY+"px",a.style.pointerEvents="none",document.body.appendChild(a);var o=document.createElement("div");o.style.color=this.fontColor,o.style.fontSize=this.fontSize+"px",o.style.lineHeight=this.fontSize+"px",o.style.margin="4px 4px 4px 4px",this.container=o,a.appendChild(o),t&&this.addFps(),r&&this.addLog()}}return e.prototype.addFps=function(){var e=document.createElement("div");e.style.display="inline-block",this.containerFps=e,this.container.appendChild(e);var t=document.createElement("div");t.style.paddingBottom="2px",this.fps=t,this.containerFps.appendChild(t),t.innerHTML="0 FPS "+this.renderMode+"<br/>min0 max0 avg0";var r=document.createElement("canvas");this.containerFps.appendChild(r),r.width=this.WIDTH,r.height=this.HEIGHT;var i=(this.canvasFps=r).getContext("2d");(this.contextFps=i).fillStyle=this.bgCanvasColor,i.fillRect(0,0,this.WIDTH,this.HEIGHT);var n=document.createElement("div");this.divDatas=n,this.containerFps.appendChild(n);var a=document.createElement("div");a.style.float="left",a.innerHTML="Draw<br/>Cost",n.appendChild(a);var o=document.createElement("div");o.style.paddingLeft=a.offsetWidth+20+"px",n.appendChild(o);var s=document.createElement("div");(this.divDraw=s).innerHTML="0<br/>",o.appendChild(s);var c=document.createElement("div");(this.divCost=c).innerHTML='<font  style="color:'+this.cost1Color+'">0<font/> <font  style="color:'+this.cost3Color+'">0<font/>',o.appendChild(c),r=document.createElement("canvas"),this.canvasCost=r,this.containerFps.appendChild(r),r.width=this.WIDTH,r.height=this.HEIGHT,i=r.getContext("2d"),(this.contextCost=i).fillStyle=this.bgCanvasColor,i.fillRect(0,0,this.WIDTH,this.HEIGHT),i.fillStyle="#000000",i.fillRect(this.WIDTH_COST,0,1,this.HEIGHT),this.fpsHeight=this.container.offsetHeight},e.prototype.addLog=function(){var e=document.createElement("div");e.style.maxWidth=document.body.clientWidth-8-this.panelX+"px",e.style.wordWrap="break-word",this.log=e,this.container.appendChild(e)},e.prototype.update=function(e,t){var r,i,n;void 0===t&&(t=!1),t?(r=this.arrFps[this.arrFps.length-1],i=this.arrCost[this.arrCost.length-1][0],n=this.arrCost[this.arrCost.length-1][1]):(r=e.fps,i=e.costTicker,n=e.costRender,this.lastNumDraw=e.draw,this.arrFps.push(r),this.arrCost.push([i,n]));var a=0,o=this.arrFps.length;101<o&&(o=101,this.arrFps.shift(),this.arrCost.shift());for(var s=this.arrFps[0],c=this.arrFps[0],l=0;l<o;l++){var h=this.arrFps[l];a+=h,h<s?s=h:c<h&&(c=h)}var u=this.WIDTH,d=this.HEIGHT,f=this.contextFps;f.drawImage(this.canvasFps,1,0,u-1,d,0,0,u-1,d),f.fillStyle=this.bgCanvasColor,f.fillRect(u-1,0,1,d);var p=Math.floor(r/60*20);p<1&&(p=1),f.fillStyle=this.fpsFrontColor,f.fillRect(u-1,20-p,1,p);var g=this.WIDTH_COST;(f=this.contextCost).drawImage(this.canvasCost,1,0,g-1,d,0,0,g-1,d),f.drawImage(this.canvasCost,g+2,0,g-1,d,g+1,0,g-1,d);var v=Math.floor(i/2);v<1?v=1:20<v&&(v=20);var y=Math.floor(n/2);y<1?y=1:20<y&&(y=20),f.fillStyle=this.bgCanvasColor,f.fillRect(g-1,0,1,d),f.fillRect(2*g,0,1,d),f.fillRect(3*g+1,0,1,d),f.fillStyle=this.cost1Color,f.fillRect(g-1,20-v,1,v),f.fillStyle=this.cost3Color,f.fillRect(2*g,20-y,1,y);var x=Math.floor(a/o),m=r+" FPS "+this.renderMode;this.showPanle&&(m+="<br/>min"+s+" max"+c+" avg"+x,this.divDraw.innerHTML=this.lastNumDraw+"<br/>",this.divCost.innerHTML='<font  style="color:#18fefe">'+i+'<font/> <font  style="color:#ff0000">'+n+"<font/>"),this.fps.innerHTML=m},e.prototype.updateInfo=function(e){this.arrLog.push(e),this.updateLogLayout()},e.prototype.updateWarn=function(e){this.arrLog.push("[Warning]"+e),this.updateLogLayout()},e.prototype.updateError=function(e){this.arrLog.push("[Error]"+e),this.updateLogLayout()},e.prototype.updateLogLayout=function(){for(this.log.innerHTML=this.arrLog.join("<br/>");document.body.clientHeight<this.log.offsetHeight+this.fpsHeight+this.panelY+2*this.fontSize;)this.arrLog.shift(),this.log.innerHTML=this.arrLog.join("<br/>")},e}(),e.WebFps=t,__reflect(t.prototype,"egret.web.WebFps",["egret.FPSDisplay"]),s.FPSDisplay=t}(egret||(egret={})),function(i){var e;(e=i.localStorage||(i.localStorage={})).web||(e.web={}),e.getItem=function(e){return window.localStorage.getItem(e)},e.setItem=function(t,r){try{return window.localStorage.setItem(t,r),!0}catch(e){return i.$warn(1047,t,r),!1}},e.removeItem=function(e){window.localStorage.removeItem(e)},e.clear=function(){window.localStorage.clear()}}(egret||(egret={})),function(E){var l,e;l=E.web||(E.web={}),e=function(i){function e(e,t){var r=i.call(this)||this;return r.init(e,t),r.initOrientation(),r}return __extends(e,i),e.prototype.init=function(e,t){var r=this.readOption(e,t),i=new E.Stage;i.$screen=this,i.$scaleMode=r.scaleMode,i.$orientation=r.orientation,i.$maxTouches=r.maxTouches,i.frameRate=r.frameRate,i.textureScaleFactor=r.textureScaleFactor;var n=new E.sys.RenderBuffer(void 0,void 0,!0),a=n.surface;this.attachCanvas(e,a);var o=new l.WebTouchHandler(i,a),s=new E.sys.Player(n,i,r.entryClassName);E.lifecycle.stage=i,E.lifecycle.addLifecycleListener(l.WebLifeCycleHandler);var c=new l.HTMLInput;(r.showFPS||r.showLog)&&(E.nativeRender||s.displayFPS(r.showFPS,r.showLog,r.logFilter,r.fpsStyles)),this.playerOption=r,this.container=e,this.canvas=a,this.stage=i,this.player=s,this.webTouchHandler=o,this.webInput=c,E.web.$cacheTextAdapter(c,i,e,a),this.updateScreenSize(),this.updateMaxTouches(),s.start()},e.prototype.initOrientation=function(){var e=this;window.addEventListener("orientationchange",function(){window.setTimeout(function(){E.StageOrientationEvent.dispatchStageOrientationEvent(e.stage,E.StageOrientationEvent.ORIENTATION_CHANGE)},350)})},e.prototype.readOption=function(e,t){var r={};r.entryClassName=e.getAttribute("data-entry-class"),r.scaleMode=e.getAttribute("data-scale-mode")||E.StageScaleMode.NO_SCALE,r.frameRate=+e.getAttribute("data-frame-rate")||30,r.contentWidth=+e.getAttribute("data-content-width")||480,r.contentHeight=+e.getAttribute("data-content-height")||800,r.orientation=e.getAttribute("data-orientation")||E.OrientationMode.AUTO,r.maxTouches=+e.getAttribute("data-multi-fingered")||2,r.textureScaleFactor=+e.getAttribute("texture-scale-factor")||1,r.showFPS="true"==e.getAttribute("data-show-fps");for(var i=(e.getAttribute("data-show-fps-style")||"").split(","),n={},a=0;a<i.length;a++){var o=i[a].split(":");n[o[0]]=o[1]}return r.fpsStyles=n,r.showLog="true"==e.getAttribute("data-show-log"),r.logFilter=e.getAttribute("data-log-filter"),r},e.prototype.attachCanvas=function(e,t){var r=t.style;r.cursor="inherit",r.position="absolute",r.top="0",r.bottom="0",r.left="0",r.right="0",e.appendChild(t),(r=e.style).overflow="hidden",r.position="absolute"},e.prototype.updateScreenSize=function(){var e=this.canvas;if(!e.userTyping){var t=this.playerOption,r=this.container.getBoundingClientRect(),i=0,n=r.width,a=r.height;if(0!=n&&0!=a){r.top<0&&(a+=r.top,i=-r.top);var o=!1,s=this.stage.$orientation;s!=E.OrientationMode.AUTO&&(o=s!=E.OrientationMode.PORTRAIT&&n<a||s==E.OrientationMode.PORTRAIT&&a<n);var c=o?a:n,l=o?n:a;E.Capabilities.boundingClientWidth=c,E.Capabilities.boundingClientHeight=l;var h=E.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,c,l,t.contentWidth,t.contentHeight),u=h.stageWidth,d=h.stageHeight,f=h.displayWidth,p=h.displayHeight;e.style[E.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px",e.width!=u&&(e.width=u),e.height!=d&&(e.height=d);var g=0;o?s==E.OrientationMode.LANDSCAPE?(g=90,e.style.top=i+(a-f)/2+"px",e.style.left=(n+p)/2+"px"):(g=-90,e.style.top=i+(a+f)/2+"px",e.style.left=(n-p)/2+"px"):(e.style.top=i+(a-p)/2+"px",e.style.left=(n-f)/2+"px");var v=f/u,y=p/d,x=v*E.sys.DisplayList.$canvasScaleFactor,m=y*E.sys.DisplayList.$canvasScaleFactor;"canvas"==E.Capabilities.renderMode&&(x=Math.ceil(x),m=Math.ceil(m));var b=E.Matrix.create();b.identity(),b.scale(v/x,y/m),b.rotate(g*Math.PI/180);var w="matrix("+b.a+","+b.b+","+b.c+","+b.d+","+b.tx+","+b.ty+")";E.Matrix.release(b),e.style[E.web.getPrefixStyleName("transform")]=w,E.sys.DisplayList.$setCanvasScale(x,m),this.webTouchHandler.updateScaleMode(v,y,g),this.webInput.$updateSize(),this.player.updateStageSize(u,d),E.nativeRender&&(e.width=u*x,e.height=d*m)}}},e.prototype.setContentSize=function(e,t){var r=this.playerOption;r.contentWidth=e,r.contentHeight=t,this.updateScreenSize()},e.prototype.updateMaxTouches=function(){this.webTouchHandler.$updateMaxTouches()},e}(E.HashObject),l.WebPlayer=e,__reflect(e.prototype,"egret.web.WebPlayer",["egret.sys.Screen"])}(egret||(egret={})),function(x){!function(e){var v,y;function a(e,t){v||(v=document.createElement("canvas"),y=v.getContext("2d"));var r=e.$getTextureWidth(),i=e.$getTextureHeight();null==t&&((t=x.$TempRectangle).x=0,t.y=0,t.width=r,t.height=i),t.x=Math.min(t.x,r-1),t.y=Math.min(t.y,i-1),t.width=Math.min(t.width,r-t.x),t.height=Math.min(t.height,i-t.y);var n=t.width,a=t.height,o=v;if(o.style.width=n+"px",o.style.height=a+"px",v.width=n,v.height=a,"webgl"==x.Capabilities.renderMode){var s=void 0;e.$renderBuffer?s=e:(s=new x.RenderTexture).drawToTexture(new x.Bitmap(e));for(var c=s.$renderBuffer.getPixels(t.x,t.y,n,a),l=new ImageData(n,a),h=0;h<c.length;h++)l.data[h]=c[h];return y.putImageData(l,0,0),e.$renderBuffer||s.dispose(),o}var u=e,d=Math.round(u.$offsetX),f=Math.round(u.$offsetY),p=u.$bitmapWidth,g=u.$bitmapHeight;return y.drawImage(u.$bitmapData.source,u.$bitmapX+t.x/x.$TextureScaleFactor,u.$bitmapY+t.y/x.$TextureScaleFactor,p*t.width/r,g*t.height/i,d,f,t.width,t.height),o}function c(e,t,r){try{return a(this,t).toDataURL(e,r)}catch(e){x.$error(1033)}return null}x.Texture.prototype.toDataURL=c,x.Texture.prototype.saveToFile=function(e,t,r,i){var n=c.call(this,e,r,i);if(null!=n){var a=n.replace(/^data:image[^;]*/,"data:image/octet-stream"),o=document.createElement("a");o.download=t,o.href=a;var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(s)}},x.Texture.prototype.getPixel32=function(e,t){return x.$warn(1041,"getPixel32","getPixels"),this.getPixels(e,t)},x.Texture.prototype.getPixels=function(e,t,r,i){if(void 0===r&&(r=1),void 0===i&&(i=1),"webgl"==x.Capabilities.renderMode){var n=void 0;return this.$renderBuffer?n=this:(n=new x.RenderTexture).drawToTexture(new x.Bitmap(this)),n.$renderBuffer.getPixels(e,t,r,i)}try{return a(this),y.getImageData(e,t,r,i).data}catch(e){x.$error(1039)}}}(x.web||(x.web={}))}(egret||(egret={})),function(r){!function(e){var t=function(e,t){this.nodeType=e,this.parent=t};e.XMLNode=t,__reflect(t.prototype,"egret.web.XMLNode");var g=function(o){function e(e,t,r,i,n){var a=o.call(this,1,t)||this;return a.attributes={},a.children=[],a.localName=e,a.prefix=r,a.namespace=i,a.name=n,a}return __extends(e,o),e}(t);e.XML=g,__reflect(g.prototype,"egret.web.XML");var v=function(i){function e(e,t){var r=i.call(this,3,t)||this;return r.text=e,r}return __extends(e,i),e}(t);e.XMLText=v,__reflect(v.prototype,"egret.web.XMLText");var a=new DOMParser;function y(e,t){if("parsererror"==e.localName)throw new Error(e.textContent);for(var r=new g(e.localName,t,e.prefix,e.namespaceURI,e.nodeName),i=e.attributes,n=r.attributes,a=i.length,o=0;o<a;o++){var s=i[o],c=s.name;0!=c.indexOf("xmlns:")&&(n[c]=s.value,r["$"+c]=s.value)}var l=e.childNodes;a=l.length;var h=r.children;for(o=0;o<a;o++){var u=l[o],d=u.nodeType,f=null;if(1==d)f=y(u,r);else if(3==d){var p=u.textContent.trim();p&&(f=new v(p,r))}f&&h.push(f)}return r}r.XML={parse:function(e){for(var t=a.parseFromString(e,"text/xml"),r=t.childNodes.length,i=0;i<r;i++){var n=t.childNodes[i];if(1==n.nodeType)return y(n,null)}return null}}}(r.web||(r.web={}))}(egret||(egret={})),function(i){var e,t;e=i.web||(i.web={}),t=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.onChange=function(e){var t=new i.OrientationEvent(i.Event.CHANGE);t.beta=e.beta,t.gamma=e.gamma,t.alpha=e.alpha,r.dispatchEvent(t)},r}return __extends(t,e),t.prototype.start=function(){window.addEventListener("deviceorientation",this.onChange)},t.prototype.stop=function(){window.removeEventListener("deviceorientation",this.onChange)},t}(i.EventDispatcher),e.WebDeviceOrientation=t,__reflect(t.prototype,"egret.web.WebDeviceOrientation",["egret.DeviceOrientation"])}(egret||(egret={})),egret.DeviceOrientation=egret.web.WebDeviceOrientation,function(n){var e,t;e=n.web||(n.web={}),t=function(t){function e(e){var i=t.call(this)||this;return i.onUpdate=function(e){var t=new n.GeolocationEvent(n.Event.CHANGE),r=e.coords;t.altitude=r.altitude,t.heading=r.heading,t.accuracy=r.accuracy,t.latitude=r.latitude,t.longitude=r.longitude,t.speed=r.speed,t.altitudeAccuracy=r.altitudeAccuracy,i.dispatchEvent(t)},i.onError=function(e){var t=n.GeolocationEvent.UNAVAILABLE;e.code==e.PERMISSION_DENIED&&(t=n.GeolocationEvent.PERMISSION_DENIED);var r=new n.GeolocationEvent(n.IOErrorEvent.IO_ERROR);r.errorType=t,r.errorMessage=e.message,i.dispatchEvent(r)},i.geolocation=navigator.geolocation,i}return __extends(e,t),e.prototype.start=function(){var e=this.geolocation;e?this.watchId=e.watchPosition(this.onUpdate,this.onError):this.onError({code:2,message:n.sys.tr(3004),PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2})},e.prototype.stop=function(){this.geolocation.clearWatch(this.watchId)},e}(n.EventDispatcher),e.WebGeolocation=t,__reflect(t.prototype,"egret.web.WebGeolocation",["egret.Geolocation"]),n.Geolocation=n.web.WebGeolocation}(egret||(egret={})),function(o){var e,t;e=o.web||(o.web={}),t=function(e){function t(){var a=null!==e&&e.apply(this,arguments)||this;return a.onChange=function(e){var t=new o.MotionEvent(o.Event.CHANGE),r={x:e.acceleration.x,y:e.acceleration.y,z:e.acceleration.z},i={x:e.accelerationIncludingGravity.x,y:e.accelerationIncludingGravity.y,z:e.accelerationIncludingGravity.z},n={alpha:e.rotationRate.alpha,beta:e.rotationRate.beta,gamma:e.rotationRate.gamma};t.acceleration=r,t.accelerationIncludingGravity=i,t.rotationRate=n,a.dispatchEvent(t)},a}return __extends(t,e),t.prototype.start=function(){window.addEventListener("devicemotion",this.onChange)},t.prototype.stop=function(){window.removeEventListener("devicemotion",this.onChange)},t}(o.EventDispatcher),e.WebMotion=t,__reflect(t.prototype,"egret.web.WebMotion",["egret.Motion"]),o.Motion=o.web.WebMotion}(egret||(egret={})),function(t){var r;t.web||(t.web={}),Object.defineProperty(t.Logger,"logLevel",{set:function(e){switch(null==r&&(r={error:console.error,debug:console.debug,warn:console.warn,info:console.info,log:console.log}),e){case t.Logger.OFF:console.error=function(){};case t.Logger.ERROR:console.warn=function(){};case t.Logger.WARN:console.info=function(){},console.log=function(){};case t.Logger.INFO:console.debug=function(){}}switch(e){case t.Logger.ALL:case t.Logger.DEBUG:console.debug=r.debug;case t.Logger.INFO:console.log=r.log,console.info=r.info;case t.Logger.WARN:console.warn=r.warn;case t.Logger.ERROR:console.error=r.error}},enumerable:!0,configurable:!0})}(egret||(egret={})),function(e){var t,r;t=e.web||(e.web={}),r=function(){function e(){this.drawData=[],this.drawDataLen=0}return e.prototype.pushDrawRect=function(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){var e=this.drawData[this.drawDataLen]||{};e.type=1,e.count=0,this.drawData[this.drawDataLen]=e,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},e.prototype.pushDrawTexture=function(e,t,r,i,n){if(void 0===t&&(t=2),r){(a=this.drawData[this.drawDataLen]||{}).type=0,a.texture=e,a.filter=r,a.count=t,a.textureWidth=i,a.textureHeight=n,this.drawData[this.drawDataLen]=a,this.drawDataLen++}else{var a;if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||e!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter)(a=this.drawData[this.drawDataLen]||{}).type=0,a.texture=e,a.count=0,this.drawData[this.drawDataLen]=a,this.drawDataLen++;this.drawData[this.drawDataLen-1].count+=t}},e.prototype.pushChangeSmoothing=function(e,t){e.smoothing=t;var r=this.drawData[this.drawDataLen]||{};r.type=10,r.texture=e,r.smoothing=t,this.drawData[this.drawDataLen]=r,this.drawDataLen++},e.prototype.pushPushMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=2,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},e.prototype.pushPopMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=3,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},e.prototype.pushSetBlend=function(e){for(var t=!1,r=this.drawDataLen-1;0<=r;r--){var i=this.drawData[r];if(i){if(0!=i.type&&1!=i.type||(t=!0),!t&&4==i.type){this.drawData.splice(r,1),this.drawDataLen--;continue}if(4==i.type){if(i.value==e)return;break}}}var n=this.drawData[this.drawDataLen]||{};n.type=4,n.value=e,this.drawData[this.drawDataLen]=n,this.drawDataLen++},e.prototype.pushResize=function(e,t,r){var i=this.drawData[this.drawDataLen]||{};i.type=5,i.buffer=e,i.width=t,i.height=r,this.drawData[this.drawDataLen]=i,this.drawDataLen++},e.prototype.pushClearColor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=6,this.drawData[this.drawDataLen]=e,this.drawDataLen++},e.prototype.pushActivateBuffer=function(e){for(var t=!1,r=this.drawDataLen-1;0<=r;r--){var i=this.drawData[r];!i||(4!=i.type&&7!=i.type&&(t=!0),t||7!=i.type)||(this.drawData.splice(r,1),this.drawDataLen--)}var n=this.drawData[this.drawDataLen]||{};n.type=7,n.buffer=e,n.width=e.rootRenderTarget.width,n.height=e.rootRenderTarget.height,this.drawData[this.drawDataLen]=n,this.drawDataLen++},e.prototype.pushEnableScissor=function(e,t,r,i){var n=this.drawData[this.drawDataLen]||{};n.type=8,n.x=e,n.y=t,n.width=r,n.height=i,this.drawData[this.drawDataLen]=n,this.drawDataLen++},e.prototype.pushDisableScissor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=9,this.drawData[this.drawDataLen]=e,this.drawDataLen++},e.prototype.clear=function(){for(var e=0;e<this.drawDataLen;e++){var t=this.drawData[e];t.type=0,t.count=0,t.texture=null,t.filter=null,t.uv=null,t.value="",t.buffer=null,t.width=0,t.height=0}this.drawDataLen=0},e}(),t.WebGLDrawCmdManager=r,__reflect(r.prototype,"egret.web.WebGLDrawCmdManager")}(egret||(egret={})),function(e){var t,r;t=e.web||(e.web={}),r=function(){function e(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var e=this.vertexMaxSize*this.vertSize,t=this.indicesMaxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(t),this.indicesForMesh=new Uint16Array(t);for(var r=0,i=0;r<t;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}return e.prototype.reachMaxSize=function(e,t){return void 0===e&&(e=4),void 0===t&&(t=6),this.vertexIndex>this.vertexMaxSize-e||this.indexIndex>this.indicesMaxSize-t},e.prototype.getVertices=function(){return this.vertices.subarray(0,this.vertexIndex*this.vertSize)},e.prototype.getIndices=function(){return this.indices},e.prototype.getMeshIndices=function(){return this.indicesForMesh},e.prototype.changeToMeshIndices=function(){if(!this.hasMesh){for(var e=0,t=this.indexIndex;e<t;++e)this.indicesForMesh[e]=this.indices[e];this.hasMesh=!0}},e.prototype.isMesh=function(){return this.hasMesh},e.prototype.cacheArrays=function(e,t,r,i,n,a,o,s,c,l,h,u,d,f,p){var g=e.globalAlpha,v=e.globalMatrix,y=v.a,x=v.b,m=v.c,b=v.d,w=v.tx,E=v.ty,T=e.$offsetX,S=e.$offsetY;if(0==T&&0==S||(w=T*y+S*m+w,E=T*x+S*b+E),!d){0==a&&0==o||(w=a*y+o*m+w,E=a*x+o*b+E);var _=s/i;1!=_&&(y*=_,x*=_);var R=c/n;1!=R&&(m*=R,b*=R)}if(d){var C,L=this.vertices,D=this.vertexIndex*this.vertSize,$=0,A=0,M=0,I=0,B=0,O=0;for($=0,C=u.length;$<C;$+=2)A=D+5*$/2,B=d[$],O=d[$+1],M=u[$],I=u[$+1],L[A+0]=y*B+m*O+w,L[A+1]=x*B+b*O+E,p?(L[A+2]=(t+(1-I)*n)/l,L[A+3]=(r+M*i)/h):(L[A+2]=(t+M*i)/l,L[A+3]=(r+I*n)/h),L[A+4]=g;if(this.hasMesh)for(var P=0,W=f.length;P<W;++P)this.indicesForMesh[this.indexIndex+P]=f[P]+this.vertexIndex;this.vertexIndex+=u.length/2,this.indexIndex+=f.length}else{var F=l,G=h,H=i,N=n;t/=F,r/=G;L=this.vertices,D=this.vertexIndex*this.vertSize;if(p){var k=i;i=n/F,n=k/G,L[D++]=w,L[D++]=E,L[D++]=i+t,L[D++]=r,L[D++]=g,L[D++]=y*H+w,L[D++]=x*H+E,L[D++]=i+t,L[D++]=n+r,L[D++]=g,L[D++]=y*H+m*N+w,L[D++]=b*N+x*H+E,L[D++]=t,L[D++]=n+r,L[D++]=g,L[D++]=m*N+w,L[D++]=b*N+E,L[D++]=t,L[D++]=r,L[D++]=g}else i/=F,n/=G,L[D++]=w,L[D++]=E,L[D++]=t,L[D++]=r,L[D++]=g,L[D++]=y*H+w,L[D++]=x*H+E,L[D++]=i+t,L[D++]=r,L[D++]=g,L[D++]=y*H+m*N+w,L[D++]=b*N+x*H+E,L[D++]=i+t,L[D++]=n+r,L[D++]=g,L[D++]=m*N+w,L[D++]=b*N+E,L[D++]=t,L[D++]=n+r,L[D++]=g;if(this.hasMesh){var U=this.indicesForMesh;U[this.indexIndex+0]=0+this.vertexIndex,U[this.indexIndex+1]=1+this.vertexIndex,U[this.indexIndex+2]=2+this.vertexIndex,U[this.indexIndex+3]=0+this.vertexIndex,U[this.indexIndex+4]=2+this.vertexIndex,U[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},e.prototype.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},e}(),t.WebGLVertexArrayObject=r,__reflect(r.prototype,"egret.web.WebGLVertexArrayObject")}(egret||(egret={})),function(t){var e,r;e=t.web||(t.web={}),r=function(n){function e(e,t,r){var i=n.call(this)||this;return i.clearColor=[0,0,0,0],i.useFrameBuffer=!0,i.gl=e,i.width=t||1,i.height=r||1,i}return __extends(e,n),e.prototype.resize=function(e,t){var r=this.gl;this.width=e,this.height=t,this.frameBuffer&&(r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null)),this.stencilBuffer&&(r.deleteRenderbuffer(this.stencilBuffer),this.stencilBuffer=null)},e.prototype.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer())},e.prototype.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},e.prototype.initFrameBuffer=function(){if(!this.frameBuffer){var e=this.gl;this.texture=this.createTexture(),this.frameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0)}},e.prototype.createTexture=function(){var e=this.gl,t=e.createTexture();return(t.glContext=e).bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},e.prototype.clear=function(e){var t=this.gl;e&&this.activate(),t.colorMask(!0,!0,!0,!0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clear(t.COLOR_BUFFER_BIT)},e.prototype.enabledStencil=function(){if(this.frameBuffer&&!this.stencilBuffer){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),this.stencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.width,this.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencilBuffer)}},e.prototype.dispose=function(){t.WebGLUtils.deleteWebGLTexture(this.texture)},e}(t.HashObject),e.WebGLRenderTarget=r,__reflect(r.prototype,"egret.web.WebGLRenderTarget")}(egret||(egret={})),function(o){var h,e;h=o.web||(o.web={}),e=function(){function n(e,t){var r,i,n;if(this.glID=null,this.projectionX=NaN,this.projectionY=NaN,this.contextLost=!1,this.$scissorState=!1,this.vertSize=5,this.surface=(r=e,i=t,n=document.createElement("canvas"),isNaN(r)||isNaN(i)||(n.width=r,n.height=i),n),!o.nativeRender){this.initWebGL(),this.$bufferStack=[];var a=this.context;this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new h.WebGLDrawCmdManager,this.vao=new h.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}}return n.getInstance=function(e,t){return this.instance||(this.instance=new n(e,t)),this.instance},n.prototype.pushBuffer=function(e){this.$bufferStack.push(e),e!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(e)),this.currentBuffer=e},n.prototype.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var e=this.$bufferStack.pop(),t=this.$bufferStack[this.$bufferStack.length-1];e!=t&&this.drawCmdManager.pushActivateBuffer(t),this.currentBuffer=t}},n.prototype.activateBuffer=function(e,t,r){e.rootRenderTarget.activate(),this.bindIndices||this.uploadIndicesArray(this.vao.getIndices()),e.restoreStencil(),e.restoreScissor(),this.onResize(t,r)},n.prototype.uploadVerticesArray=function(e){var t=this.context;t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW)},n.prototype.uploadIndicesArray=function(e){var t=this.context;t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),this.bindIndices=!0},n.prototype.destroy=function(){this.surface.width=this.surface.height=0},n.prototype.onResize=function(e,t){e=e||this.surface.width,t=t||this.surface.height,this.projectionX=e/2,this.projectionY=-t/2,this.context&&this.context.viewport(0,0,e,t)},n.prototype.resize=function(e,t,r){var i=this.surface;r?(i.width<e&&(i.width=e),i.height<t&&(i.height=t)):(i.width!=e&&(i.width=e),i.height!=t&&(i.height=t)),this.onResize()},n.prototype.initWebGL=function(){this.onResize(),this.surface.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1),this.surface.addEventListener("webglcontextrestored",this.handleContextRestored.bind(this),!1),this.getWebGLContext();var e=this.context;this.$maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)},n.prototype.handleContextLost=function(){this.contextLost=!0},n.prototype.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},n.prototype.getWebGLContext=function(){for(var e,t={antialias:n.antialias,stencil:!0},r=["webgl","experimental-webgl"],i=0;i<r.length;i++){try{e=this.surface.getContext(r[i],t)}catch(e){}if(e)break}e||o.$error(1021),this.setContext(e)},n.prototype.setContext=function(e){(this.context=e).id=n.glContextId++,this.glID=e.id,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.colorMask(!0,!0,!0,!0),e.activeTexture(e.TEXTURE0)},n.prototype.enableStencilTest=function(){var e=this.context;e.enable(e.STENCIL_TEST)},n.prototype.disableStencilTest=function(){var e=this.context;e.disable(e.STENCIL_TEST)},n.prototype.enableScissorTest=function(e){var t=this.context;t.enable(t.SCISSOR_TEST),t.scissor(e.x,e.y,e.width,e.height)},n.prototype.disableScissorTest=function(){var e=this.context;e.disable(e.SCISSOR_TEST)},n.prototype.getPixels=function(e,t,r,i,n){var a=this.context;a.readPixels(e,t,r,i,a.RGBA,a.UNSIGNED_BYTE,n)},n.prototype.createTexture=function(e){var t=this.context,r=t.createTexture();if(r)return(r.glContext=t).bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r;this.contextLost=!0},n.prototype.createTextureFromCompressedData=function(e,t,r,i,n){return null},n.prototype.updateTexture=function(e,t){var r=this.context;r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)},n.prototype.getWebGLTexture=function(e){return e.webGLTexture||("image"==e.format?e.webGLTexture=this.createTexture(e.source):"pvr"==e.format&&(e.webGLTexture=this.createTextureFromCompressedData(e.source.pvrtcData,e.width,e.height,e.source.mipmapsCount,e.source.format)),e.$deleteSource&&e.webGLTexture&&(e.source=null),e.webGLTexture&&(e.webGLTexture.smoothing=!0)),e.webGLTexture},n.prototype.clearRect=function(e,t,r,i){if(0!=e||0!=t||r!=this.surface.width||i!=this.surface.height){var n=this.currentBuffer;if(n.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,r,i),this.setGlobalCompositeOperation("source-over");else{var a=n.globalMatrix;0==a.b&&0==a.c?(e=e*a.a+a.tx,t=t*a.d+a.ty,r*=a.a,i*=a.d,this.enableScissor(e,-t-i+n.height,r,i),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,r,i),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},n.prototype.setGlobalCompositeOperation=function(e){this.drawCmdManager.pushSetBlend(e)},n.prototype.drawImage=function(e,t,r,i,n,a,o,s,c,l,h,u,d){var f=this.currentBuffer;if(!this.contextLost&&e&&f){var p,g,v;if(e.texture||e.source&&e.source.texture)p=e.texture||e.source.texture,f.saveTransform(),g=f.$offsetX,v=f.$offsetY,f.useOffset(),f.transform(1,0,0,-1,0,c+2*o);else{if(!e.source&&!e.webGLTexture)return;p=this.getWebGLTexture(e)}p&&(this.drawTexture(p,t,r,i,n,a,o,s,c,l,h,void 0,void 0,void 0,void 0,u,d),e.source&&e.source.texture&&(f.$offsetX=g,f.$offsetY=v,f.restoreTransform()))}},n.prototype.drawMesh=function(e,t,r,i,n,a,o,s,c,l,h,u,d,f,p,g,v){var y=this.currentBuffer;if(!this.contextLost&&e&&y){var x,m,b;if(e.texture||e.source&&e.source.texture)x=e.texture||e.source.texture,y.saveTransform(),m=y.$offsetX,b=y.$offsetY,y.useOffset(),y.transform(1,0,0,-1,0,c+2*o);else{if(!e.source&&!e.webGLTexture)return;x=this.getWebGLTexture(e)}x&&(this.drawTexture(x,t,r,i,n,a,o,s,c,l,h,u,d,f,p,g,v),(e.texture||e.source&&e.source.texture)&&(y.$offsetX=m,y.$offsetY=b,y.restoreTransform()))}},n.prototype.drawTexture=function(e,t,r,i,n,a,o,s,c,l,h,u,d,f,p,g,v){var y=this.currentBuffer;if(!this.contextLost&&e&&y){d&&f?this.vao.reachMaxSize(d.length/2,f.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),null!=v&&e.smoothing!=v&&this.drawCmdManager.pushChangeSmoothing(e,v),u&&this.vao.changeToMeshIndices();var x=f?f.length/3:2;this.drawCmdManager.pushDrawTexture(e,x,this.$filter,l,h),this.vao.cacheArrays(y,t,r,i,n,a,o,s,c,l,h,u,d,f,g)}},n.prototype.drawRect=function(e,t,r,i){var n=this.currentBuffer;!this.contextLost&&n&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(n,0,0,r,i,e,t,r,i,r,i))},n.prototype.pushMask=function(e,t,r,i){var n=this.currentBuffer;!this.contextLost&&n&&(n.$stencilList.push({x:e,y:t,width:r,height:i}),this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(n,0,0,r,i,e,t,r,i,r,i))},n.prototype.popMask=function(){var e=this.currentBuffer;if(!this.contextLost&&e){var t=e.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(e,0,0,t.width,t.height,t.x,t.y,t.width,t.height,t.width,t.height)}},n.prototype.clear=function(){this.drawCmdManager.pushClearColor()},n.prototype.enableScissor=function(e,t,r,i){var n=this.currentBuffer;this.drawCmdManager.pushEnableScissor(e,t,r,i),n.$hasScissor=!0},n.prototype.disableScissor=function(){var e=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),e.$hasScissor=!1},n.prototype.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var e=this.drawCmdManager.drawDataLen,t=0,r=0;r<e;r++){var i=this.drawCmdManager.drawData[r];t=this.drawData(i,t),7==i.type&&(this.activatedBuffer=i.buffer),0!=i.type&&1!=i.type&&2!=i.type&&3!=i.type||this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},n.prototype.drawData=function(e,t){if(e){var r,i=this.context,n=e.filter;switch(e.type){case 0:n?"custom"===n.type?r=h.EgretWebGLProgram.getProgram(i,n.$vertexSrc,n.$fragmentSrc,n.$shaderKey):"colorTransform"===n.type?r=h.EgretWebGLProgram.getProgram(i,h.EgretShaderLib.default_vert,h.EgretShaderLib.colorTransform_frag,"colorTransform"):"blurX"===n.type?r=h.EgretWebGLProgram.getProgram(i,h.EgretShaderLib.default_vert,h.EgretShaderLib.blur_frag,"blur"):"blurY"===n.type?r=h.EgretWebGLProgram.getProgram(i,h.EgretShaderLib.default_vert,h.EgretShaderLib.blur_frag,"blur"):"glow"===n.type&&(r=h.EgretWebGLProgram.getProgram(i,h.EgretShaderLib.default_vert,h.EgretShaderLib.glow_frag,"glow")):r=h.EgretWebGLProgram.getProgram(i,h.EgretShaderLib.default_vert,h.EgretShaderLib.texture_frag,"texture"),this.activeProgram(i,r),this.syncUniforms(r,n,e.textureWidth,e.textureHeight),t+=this.drawTextureElements(e,t);break;case 1:r=h.EgretWebGLProgram.getProgram(i,h.EgretShaderLib.default_vert,h.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(i,r),this.syncUniforms(r,n,e.textureWidth,e.textureHeight),t+=this.drawRectElements(e,t);break;case 2:r=h.EgretWebGLProgram.getProgram(i,h.EgretShaderLib.default_vert,h.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(i,r),this.syncUniforms(r,n,e.textureWidth,e.textureHeight),t+=this.drawPushMaskElements(e,t);break;case 3:r=h.EgretWebGLProgram.getProgram(i,h.EgretShaderLib.default_vert,h.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(i,r),this.syncUniforms(r,n,e.textureWidth,e.textureHeight),t+=this.drawPopMaskElements(e,t);break;case 4:this.setBlendMode(e.value);break;case 5:e.buffer.rootRenderTarget.resize(e.width,e.height),this.onResize(e.width,e.height);break;case 6:if(this.activatedBuffer){var a=this.activatedBuffer.rootRenderTarget;0==a.width&&0==a.height||a.clear(!0)}break;case 7:this.activateBuffer(e.buffer,e.width,e.height);break;case 8:var o=this.activatedBuffer;o&&(o.rootRenderTarget&&o.rootRenderTarget.enabledStencil(),o.enableScissor(e.x,e.y,e.width,e.height));break;case 9:(o=this.activatedBuffer)&&o.disableScissor();break;case 10:i.bindTexture(i.TEXTURE_2D,e.texture),e.smoothing?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST))}return t}},n.prototype.activeProgram=function(e,t){if(t!=this.currentProgram){e.useProgram(t.id);var r=t.attributes;for(var i in r)"aVertexPosition"===i?(e.vertexAttribPointer(r.aVertexPosition.location,2,e.FLOAT,!1,20,0),e.enableVertexAttribArray(r.aVertexPosition.location)):"aTextureCoord"===i?(e.vertexAttribPointer(r.aTextureCoord.location,2,e.FLOAT,!1,20,8),e.enableVertexAttribArray(r.aTextureCoord.location)):"aColor"===i&&(e.vertexAttribPointer(r.aColor.location,1,e.FLOAT,!1,20,16),e.enableVertexAttribArray(r.aColor.location));this.currentProgram=t}},n.prototype.syncUniforms=function(e,t,r,i){var n=e.uniforms;t&&t.type;for(var a in n)if("projectionVector"===a)n[a].setValue({x:this.projectionX,y:this.projectionY});else if("uTextureSize"===a)n[a].setValue({x:r,y:i});else if("uSampler"===a);else{var o=t.$uniforms[a];void 0!==o&&n[a].setValue(o)}},n.prototype.drawTextureElements=function(e,t){var r=this.context;r.bindTexture(r.TEXTURE_2D,e.texture);var i=3*e.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),i},n.prototype.drawRectElements=function(e,t){var r=this.context,i=3*e.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),i},n.prototype.drawPushMaskElements=function(e,t){var r=this.context,i=3*e.count,n=this.activatedBuffer;if(n){n.rootRenderTarget&&n.rootRenderTarget.enabledStencil(),0==n.stencilHandleCount&&(n.enableStencil(),r.clear(r.STENCIL_BUFFER_BIT));var a=n.stencilHandleCount;n.stencilHandleCount++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,a,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,a+1,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},n.prototype.drawPopMaskElements=function(e,t){var r=this.context,i=3*e.count,n=this.activatedBuffer;if(n)if(n.stencilHandleCount--,0==n.stencilHandleCount)n.disableStencil();else{var a=n.stencilHandleCount;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,a+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,a,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},n.prototype.setBlendMode=function(e){var t=this.context,r=n.blendModesForGL[e];r&&t.blendFunc(r[0],r[1])},n.prototype.drawTargetWidthFilters=function(e,t){var r,i=t,n=e.length;if(1<n)for(var a=0;a<n-1;a++){var o=e[a],s=t.rootRenderTarget.width,c=t.rootRenderTarget.height;(r=h.WebGLRenderBuffer.create(s,c)).setTransform(1,0,0,1,0,0),r.globalAlpha=1,this.drawToRenderTarget(o,t,r),t!=i&&h.WebGLRenderBuffer.release(t),t=r}var l=e[n-1];this.drawToRenderTarget(l,t,this.currentBuffer),t!=i&&h.WebGLRenderBuffer.release(t)},n.prototype.drawToRenderTarget=function(e,t,r){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(r);var i,n=t,a=t.rootRenderTarget.width,o=t.rootRenderTarget.height;if("blur"==e.type){var s=e.blurXFilter,c=e.blurYFilter;0!=s.blurX&&0!=c.blurY?((i=h.WebGLRenderBuffer.create(a,o)).setTransform(1,0,0,1,0,0),i.globalAlpha=1,this.drawToRenderTarget(e.blurXFilter,t,i),t!=n&&h.WebGLRenderBuffer.release(t),t=i,e=c):e=0===s.blurX?c:s}r.saveTransform(),r.transform(1,0,0,-1,0,o),this.vao.cacheArrays(r,0,0,a,o,0,0,a,o,a,o),r.restoreTransform(),this.drawCmdManager.pushDrawTexture(t.rootRenderTarget.texture,2,e,a,o),t!=n&&h.WebGLRenderBuffer.release(t),this.popBuffer()}},n.initBlendMode=function(){(n.blendModesForGL={})["source-over"]=[1,771],n.blendModesForGL.lighter=[1,1],n.blendModesForGL["lighter-in"]=[770,771],n.blendModesForGL["destination-out"]=[0,771],n.blendModesForGL["destination-in"]=[0,770]},n.glContextId=0,n.blendModesForGL=null,n}(),h.WebGLRenderContext=e,__reflect(e.prototype,"egret.web.WebGLRenderContext"),e.initBlendMode()}(egret||(egret={})),function(d){!function(o){var e=function(a){function n(e,t,r){var i=a.call(this)||this;if(i.globalAlpha=1,i.stencilState=!1,i.$stencilList=[],i.stencilHandleCount=0,i.$scissorState=!1,i.scissorRect=new d.Rectangle,i.$hasScissor=!1,i.$drawCalls=0,i.$computeDrawCall=!1,i.globalMatrix=new d.Matrix,i.savedGlobalMatrix=new d.Matrix,i.$offsetX=0,i.$offsetY=0,i.context=o.WebGLRenderContext.getInstance(e,t),d.nativeRender)return i.surface=r?i.context.surface:new egret_native.NativeRenderSurface(i,e,t,r),i.rootRenderTarget=null,i;if(i.rootRenderTarget=new o.WebGLRenderTarget(i.context.context,3,3),e&&t&&i.resize(e,t),i.root=r,i.root)i.context.pushBuffer(i),i.surface=i.context.surface,i.$computeDrawCall=!0;else{var n=i.context.activatedBuffer;n&&n.rootRenderTarget.activate(),i.rootRenderTarget.initFrameBuffer(),i.surface=i.rootRenderTarget}return i}return __extends(n,a),n.prototype.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},n.prototype.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},n.prototype.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},n.prototype.enableScissor=function(e,t,r,i){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(e,t,r,i),this.context.enableScissorTest(this.scissorRect))},n.prototype.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},n.prototype.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},Object.defineProperty(n.prototype,"width",{get:function(){return d.nativeRender?this.surface.width:this.rootRenderTarget.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return d.nativeRender?this.surface.height:this.rootRenderTarget.height},enumerable:!0,configurable:!0}),n.prototype.resize=function(e,t,r){e=e||1,t=t||1,d.nativeRender?this.surface.resize(e,t):(this.context.pushBuffer(this),e==this.rootRenderTarget.width&&t==this.rootRenderTarget.height||(this.context.drawCmdManager.pushResize(this,e,t),this.rootRenderTarget.width=e,this.rootRenderTarget.height=t),this.root&&this.context.resize(e,t,r),this.context.clear(),this.context.popBuffer())},n.prototype.getPixels=function(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=1);var n=new Uint8Array(4*r*i);if(d.nativeRender)egret_native.activateBuffer(this),egret_native.nrGetPixels(e,t,r,i,n),egret_native.activateBuffer(null);else{var a=this.rootRenderTarget.useFrameBuffer;this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(e,t,r,i,n),this.rootRenderTarget.useFrameBuffer=a,this.rootRenderTarget.activate()}for(var o=new Uint8Array(4*r*i),s=0;s<i;s++)for(var c=0;c<r;c++){var l=4*(r*(i-s-1)+c),h=4*(r*s+c),u=n[h+3];o[l]=Math.round(n[h]/u*255),o[l+1]=Math.round(n[h+1]/u*255),o[l+2]=Math.round(n[h+2]/u*255),o[l+3]=n[h+3]}return o},n.prototype.toDataURL=function(e,t){return this.context.surface.toDataURL(e,t)},n.prototype.destroy=function(){this.context.destroy()},n.prototype.onRenderFinish=function(){this.$drawCalls=0},n.prototype.drawFrameBufferToSurface=function(e,t,r,i,n,a,o,s,c){void 0===c&&(c=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),c&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,e,t,r,i,n,a,o,s,r,i,!1),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},n.prototype.drawSurfaceToFrameBuffer=function(e,t,r,i,n,a,o,s,c){void 0===c&&(c=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),c&&this.context.clear(),this.context.drawImage(this.context.surface,e,t,r,i,n,a,o,s,r,i,!1),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},n.prototype.clear=function(){this.context.pushBuffer(this),this.context.clear(),this.context.popBuffer()},n.prototype.setTransform=function(e,t,r,i,n,a){var o=this.globalMatrix;o.a=e,o.b=t,o.c=r,o.d=i,o.tx=n,o.ty=a},n.prototype.transform=function(e,t,r,i,n,a){var o=this.globalMatrix,s=o.a,c=o.b,l=o.c,h=o.d;1==e&&0==t&&0==r&&1==i||(o.a=e*s+t*l,o.b=e*c+t*h,o.c=r*s+i*l,o.d=r*c+i*h),o.tx=n*s+a*l+o.tx,o.ty=n*c+a*h+o.ty},n.prototype.useOffset=function(){var e=this;0==e.$offsetX&&0==e.$offsetY||(e.globalMatrix.append(1,0,0,1,e.$offsetX,e.$offsetY),e.$offsetX=e.$offsetY=0)},n.prototype.saveTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},n.prototype.restoreTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},n.create=function(e,t){var r=s.pop();if(r){r.resize(e,t);var i=r.globalMatrix;i.a=1,i.b=0,i.c=0,i.d=1,i.tx=0,i.ty=0,r.globalAlpha=1,r.$offsetX=0,r.$offsetY=0}else(r=new n(e,t)).$computeDrawCall=!1;return r},n.release=function(e){s.push(e)},n.autoClear=!0,n}(d.HashObject);o.WebGLRenderBuffer=e,__reflect(e.prototype,"egret.web.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var s=[]}(d.web||(d.web={}))}(egret||(egret={})),function(_){var f,R,C,L,e;f=_.web||(_.web={}),R=["source-over","lighter","destination-out"],C="source-over",L=[],e=function(){function e(){this.nestLevel=0}return e.prototype.render=function(e,t,r,i){this.nestLevel++;var n=t,a=n.context;a.pushBuffer(n),n.transform(r.a,r.b,r.c,r.d,0,0),this.drawDisplayObject(e,n,r.tx,r.ty,!0),a.$drawWebGL();var o=n.$drawCalls;n.onRenderFinish(),a.popBuffer();var s=_.Matrix.create();if(r.$invertInto(s),n.transform(s.a,s.b,s.c,s.d,0,0),_.Matrix.release(s),this.nestLevel--,0===this.nestLevel){6<L.length&&(L.length=6);for(var c=L.length,l=0;l<c;l++)L[l].resize(0,0)}return o},e.prototype.drawDisplayObject=function(e,t,r,i,n){var a,o=0,s=e.$displayList;if(s&&!n?((e.$cacheDirty||e.$renderDirty||s.$canvasScaleX!=_.sys.DisplayList.$canvasScaleX||s.$canvasScaleY!=_.sys.DisplayList.$canvasScaleY)&&(o+=s.drawToSurface()),a=s.$renderNode):a=e.$renderDirty?e.$getRenderNode():e.$renderNode,e.$cacheDirty=!1,a){switch(o++,t.$offsetX=r,t.$offsetY=i,a.type){case 1:this.renderBitmap(a,t);break;case 2:this.renderText(a,t);break;case 3:this.renderGraphics(a,t);break;case 4:this.renderGroup(a,t);break;case 5:this.renderMesh(a,t);break;case 6:this.renderNormalBitmap(a,t)}t.$offsetX=0,t.$offsetY=0}if(s&&!n)return o;var c=e.$children;if(c)for(var l=c.length,h=0;h<l;h++){var u=c[h],d=void 0,f=void 0,p=void 0;1!=u.$alpha&&(p=t.globalAlpha,t.globalAlpha*=u.$alpha);var g=void 0;if(u.$useTranslate){var v=u.$getMatrix();d=r+u.$x,f=i+u.$y;var y=t.globalMatrix;(g=_.Matrix.create()).a=y.a,g.b=y.b,g.c=y.c,g.d=y.d,g.tx=y.tx,g.ty=y.ty,t.transform(v.a,v.b,v.c,v.d,d,f),d=-u.$anchorOffsetX,f=-u.$anchorOffsetY}else d=r+u.$x-u.$anchorOffsetX,f=i+u.$y-u.$anchorOffsetY;switch(u.$renderMode){case 1:break;case 2:o+=this.drawWithFilter(u,t,d,f);break;case 3:o+=this.drawWithClip(u,t,d,f);break;case 4:o+=this.drawWithScrollRect(u,t,d,f);break;default:o+=this.drawDisplayObject(u,t,d,f)}if(p&&(t.globalAlpha=p),g)(v=t.globalMatrix).a=g.a,v.b=g.b,v.c=g.c,v.d=g.d,v.tx=g.tx,v.ty=g.ty,_.Matrix.release(g)}return o},e.prototype.drawWithFilter=function(e,t,r,i){var n=0;if(e.$children&&0==e.$children.length&&(!e.$renderNode||0==e.$renderNode.$getRenderCount()))return n;var a,o=e.$filters,s=0!==e.$blendMode;s&&((a=R[e.$blendMode])||(a=C));var c=e.$getOriginalBounds(),l=c.x,h=c.y,u=c.width,d=c.height;if(u<=0||d<=0)return n;if(!e.mask&&1==o.length&&("colorTransform"==o[0].type||"custom"===o[0].type&&0===o[0].padding)){var f=this.getRenderCount(e);if(!e.$children||1==f)return s&&t.context.setGlobalCompositeOperation(a),t.context.$filter=o[0],e.$mask?n+=this.drawWithClip(e,t,r,i):e.$scrollRect||e.$maskRect?n+=this.drawWithScrollRect(e,t,r,i):n+=this.drawDisplayObject(e,t,r,i),t.context.$filter=null,s&&t.context.setGlobalCompositeOperation(C),n}var p=this.createRenderBuffer(u,d);if(p.context.pushBuffer(p),e.$mask?n+=this.drawWithClip(e,p,-l,-h):e.$scrollRect||e.$maskRect?n+=this.drawWithScrollRect(e,p,-l,-h):n+=this.drawDisplayObject(e,p,-l,-h),p.context.popBuffer(),0<n){s&&t.context.setGlobalCompositeOperation(a),n++,t.$offsetX=r+l,t.$offsetY=i+h;var g=_.Matrix.create(),v=t.globalMatrix;g.a=v.a,g.b=v.b,g.c=v.c,g.d=v.d,g.tx=v.tx,g.ty=v.ty,t.useOffset(),t.context.drawTargetWidthFilters(o,p),v.a=g.a,v.b=g.b,v.c=g.c,v.d=g.d,v.tx=g.tx,v.ty=g.ty,_.Matrix.release(g),s&&t.context.setGlobalCompositeOperation(C)}return L.push(p),n},e.prototype.getRenderCount=function(e){var t=0,r=e.$getRenderNode();if(r&&(t+=r.$getRenderCount()),e.$children)for(var i=0,n=e.$children;i<n.length;i++){var a=n[i],o=a.$filters;if(o&&0<o.length)return 2;if(a.$children)t+=this.getRenderCount(a);else{var s=a.$getRenderNode();s&&(t+=s.$getRenderCount())}}return t},e.prototype.drawWithClip=function(e,t,r,i){var n,a=0,o=0!==e.$blendMode;o&&((n=R[e.$blendMode])||(n=C));var s=e.$scrollRect?e.$scrollRect:e.$maskRect,c=e.$mask;if(c){var l=c.$getMatrix();if(0==l.a&&0==l.b||0==l.c&&0==l.d)return a}if(c||e.$children&&0!=e.$children.length){var h=e.$getOriginalBounds(),u=h.x,d=h.y,f=h.width,p=h.height;if(f<=0||p<=0)return a;var g=this.createRenderBuffer(f,p);if(g.context.pushBuffer(g),a+=this.drawDisplayObject(e,g,-u,-d),c){var v=this.createRenderBuffer(f,p);v.context.pushBuffer(v);var y=_.Matrix.create();y.copyFrom(c.$getConcatenatedMatrix()),c.$getConcatenatedMatrixAt(e,y),y.translate(-u,-d),v.setTransform(y.a,y.b,y.c,y.d,y.tx,y.ty),_.Matrix.release(y),a+=this.drawDisplayObject(c,v,0,0),v.context.popBuffer(),g.context.setGlobalCompositeOperation("destination-in"),g.setTransform(1,0,0,-1,0,v.height);var x=v.rootRenderTarget.width,m=v.rootRenderTarget.height;g.context.drawTexture(v.rootRenderTarget.texture,0,0,x,m,0,0,x,m,x,m),g.setTransform(1,0,0,1,0,0),g.context.setGlobalCompositeOperation("source-over"),v.setTransform(1,0,0,1,0,0),L.push(v)}if(g.context.setGlobalCompositeOperation(C),g.context.popBuffer(),0<a){a++,o&&t.context.setGlobalCompositeOperation(n),s&&t.context.pushMask(s.x+r,s.y+i,s.width,s.height);var b=_.Matrix.create(),w=t.globalMatrix;b.a=w.a,b.b=w.b,b.c=w.c,b.d=w.d,b.tx=w.tx,b.ty=w.ty,w.append(1,0,0,-1,r+u,i+d+g.height);var E=g.rootRenderTarget.width,T=g.rootRenderTarget.height;t.context.drawTexture(g.rootRenderTarget.texture,0,0,E,T,0,0,E,T,E,T),s&&g.context.popMask(),o&&t.context.setGlobalCompositeOperation(C);var S=t.globalMatrix;S.a=b.a,S.b=b.b,S.c=b.c,S.d=b.d,S.tx=b.tx,S.ty=b.ty,_.Matrix.release(b)}return L.push(g),a}return s&&t.context.pushMask(s.x+r,s.y+i,s.width,s.height),o&&t.context.setGlobalCompositeOperation(n),a+=this.drawDisplayObject(e,t,r,i),o&&t.context.setGlobalCompositeOperation(C),s&&t.context.popMask(),a},e.prototype.drawWithScrollRect=function(e,t,r,i){var n=0,a=e.$scrollRect?e.$scrollRect:e.$maskRect;if(a.isEmpty())return n;e.$scrollRect&&(r-=a.x,i-=a.y);var o=t.globalMatrix,s=t.context,c=!1;if(t.$hasScissor||0!=o.b||0!=o.c)t.context.pushMask(a.x+r,a.y+i,a.width,a.height);else{var l=o.a,h=o.d,u=o.tx,d=o.ty,f=a.x+r,p=a.y+i,g=f+a.width,v=p+a.height,y=void 0,x=void 0,m=void 0,b=void 0;if(1==l&&1==h)y=f+u,x=p+d,m=g+u,b=v+d;else{var w=l*f+u,E=h*p+d,T=l*g+u,S=h*p+d,_=l*g+u,R=h*v+d,C=l*f+u,L=h*v+d,D=0;T<w&&(D=w,w=T,T=D),C<_&&(D=_,_=C,C=D),y=w<_?w:_,m=C<T?T:C,S<E&&(D=E,E=S,S=D),L<R&&(D=R,R=L,L=D),x=E<R?E:R,b=L<S?S:L}s.enableScissor(y,-b+t.height,m-y,b-x),c=!0}return n+=this.drawDisplayObject(e,t,r,i),c?s.disableScissor():s.popMask(),n},e.prototype.drawNodeToBuffer=function(e,t,r,i){var n=t;n.context.pushBuffer(n),n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.renderNode(e,t,0,0,i),n.context.$drawWebGL(),n.onRenderFinish(),n.context.popBuffer()},e.prototype.drawDisplayToBuffer=function(e,t,r){var i;t.context.pushBuffer(t),r&&t.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty);var n=0;if(i=e.$renderDirty?e.$getRenderNode():e.$renderNode)switch(n++,i.type){case 1:this.renderBitmap(i,t);break;case 2:this.renderText(i,t);break;case 3:this.renderGraphics(i,t);break;case 4:this.renderGroup(i,t);break;case 5:this.renderMesh(i,t);break;case 6:this.renderNormalBitmap(i,t)}var a=e.$children;if(a)for(var o=a.length,s=0;s<o;s++){var c=a[s];switch(c.$renderMode){case 1:break;case 2:n+=this.drawWithFilter(c,t,0,0);break;case 3:n+=this.drawWithClip(c,t,0,0);break;case 4:n+=this.drawWithScrollRect(c,t,0,0);break;default:n+=this.drawDisplayObject(c,t,0,0)}}return t.context.$drawWebGL(),t.onRenderFinish(),t.context.popBuffer(),n},e.prototype.renderNode=function(e,t,r,i,n){switch(t.$offsetX=r,t.$offsetY=i,e.type){case 1:this.renderBitmap(e,t);break;case 2:this.renderText(e,t);break;case 3:this.renderGraphics(e,t,n);break;case 4:this.renderGroup(e,t);break;case 5:this.renderMesh(e,t);break;case 6:this.renderNormalBitmap(e,t)}},e.prototype.renderNormalBitmap=function(e,t){var r=e.image;r&&t.context.drawImage(r,e.sourceX,e.sourceY,e.sourceW,e.sourceH,e.drawX,e.drawY,e.drawW,e.drawH,e.imageWidth,e.imageHeight,e.rotated,e.smoothing)},e.prototype.renderBitmap=function(e,t){var r=e.image;if(r){var i,n,a,o,s=e.drawData,c=s.length,l=0,h=e.matrix,u=e.blendMode,d=e.alpha;if(h){i=_.Matrix.create();var f=t.globalMatrix;i.a=f.a,i.b=f.b,i.c=f.c,i.d=f.d,i.tx=f.tx,i.ty=f.ty,n=t.$offsetX,a=t.$offsetY,t.useOffset(),t.transform(h.a,h.b,h.c,h.d,h.tx,h.ty)}if(u&&t.context.setGlobalCompositeOperation(R[u]),d==d&&(o=t.globalAlpha,t.globalAlpha*=d),e.filter){for(t.context.$filter=e.filter;l<c;)t.context.drawImage(r,s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],e.imageWidth,e.imageHeight,e.rotated,e.smoothing);t.context.$filter=null}else for(;l<c;)t.context.drawImage(r,s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],e.imageWidth,e.imageHeight,e.rotated,e.smoothing);if(u&&t.context.setGlobalCompositeOperation(C),d==d&&(t.globalAlpha=o),h){var p=t.globalMatrix;p.a=i.a,p.b=i.b,p.c=i.c,p.d=i.d,p.tx=i.tx,p.ty=i.ty,t.$offsetX=n,t.$offsetY=a,_.Matrix.release(i)}}},e.prototype.renderMesh=function(e,t){var r,i,n,a,o=e.image,s=e.drawData,c=s.length,l=0,h=e.matrix,u=e.blendMode,d=e.alpha;if(h){r=_.Matrix.create();var f=t.globalMatrix;r.a=f.a,r.b=f.b,r.c=f.c,r.d=f.d,r.tx=f.tx,r.ty=f.ty,i=t.$offsetX,n=t.$offsetY,t.useOffset(),t.transform(h.a,h.b,h.c,h.d,h.tx,h.ty)}if(u&&t.context.setGlobalCompositeOperation(R[u]),d==d&&(a=t.globalAlpha,t.globalAlpha*=d),e.filter){for(t.context.$filter=e.filter;l<c;)t.context.drawMesh(o,s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds,e.rotated,e.smoothing);t.context.$filter=null}else for(;l<c;)t.context.drawMesh(o,s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],s[l++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds,e.rotated,e.smoothing);if(u&&t.context.setGlobalCompositeOperation(C),d==d&&(t.globalAlpha=a),h){var p=t.globalMatrix;p.a=r.a,p.b=r.b,p.c=r.c,p.d=r.d,p.tx=r.tx,p.ty=r.ty,t.$offsetX=i,t.$offsetY=n,_.Matrix.release(r)}},e.prototype.renderText=function(e,t){var r=e.width-e.x,i=e.height-e.y;if(!(r<=0||i<=0)&&r&&i&&0!=e.drawData.length){var n=_.sys.DisplayList.$canvasScaleX,a=_.sys.DisplayList.$canvasScaleY,o=t.context.$maxTextureSize;o<r*n&&(n*=o/(r*n)),o<i*a&&(a*=o/(i*a)),r*=n,i*=a;var s=e.x*n,c=e.y*a;if(e.$canvasScaleX==n&&e.$canvasScaleY==a||(e.$canvasScaleX=n,e.$canvasScaleY=a,e.dirtyRender=!0),this.canvasRenderBuffer&&this.canvasRenderBuffer.context?e.dirtyRender&&this.canvasRenderBuffer.resize(r,i):(this.canvasRenderer=new _.CanvasRenderer,this.canvasRenderBuffer=new f.CanvasRenderBuffer(r,i)),this.canvasRenderBuffer.context){if(1==n&&1==a||this.canvasRenderBuffer.context.setTransform(n,0,0,a,0,0),s||c?(e.dirtyRender&&this.canvasRenderBuffer.context.setTransform(n,0,0,a,-s,-c),t.transform(1,0,0,1,s/n,c/a)):1==n&&1==a||this.canvasRenderBuffer.context.setTransform(n,0,0,a,0,0),e.dirtyRender){var l=this.canvasRenderBuffer.surface;this.canvasRenderer.renderText(e,this.canvasRenderBuffer.context);var h=e.$texture;h?t.context.updateTexture(h,l):(h=t.context.createTexture(l),e.$texture=h),e.$textureWidth=l.width,e.$textureHeight=l.height}var u=e.$textureWidth,d=e.$textureHeight;t.context.drawTexture(e.$texture,0,0,u,d,0,0,u/n,d/a,u,d),(s||c)&&(e.dirtyRender&&this.canvasRenderBuffer.context.setTransform(n,0,0,a,0,0),t.transform(1,0,0,1,-s/n,-c/a)),e.dirtyRender=!1}}},e.prototype.renderGraphics=function(e,t,r){var i=e.width,n=e.height;if(!(i<=0||n<=0)&&i&&n&&0!=e.drawData.length){var a=_.sys.DisplayList.$canvasScaleX,o=_.sys.DisplayList.$canvasScaleY;(i*a<1||n*o<1)&&(a=o=1),e.$canvasScaleX==a&&e.$canvasScaleY==o||(e.$canvasScaleX=a,e.$canvasScaleY=o,e.dirtyRender=!0),i*=a,n*=o;var s=Math.ceil(i),c=Math.ceil(n);if(a*=s/i,o*=c/n,i=s,n=c,this.canvasRenderBuffer&&this.canvasRenderBuffer.context?(e.dirtyRender||r)&&this.canvasRenderBuffer.resize(i,n):(this.canvasRenderer=new _.CanvasRenderer,this.canvasRenderBuffer=new f.CanvasRenderBuffer(i,n)),this.canvasRenderBuffer.context){1==a&&1==o||this.canvasRenderBuffer.context.setTransform(a,0,0,o,0,0),(e.x||e.y)&&((e.dirtyRender||r)&&this.canvasRenderBuffer.context.translate(-e.x,-e.y),t.transform(1,0,0,1,e.x,e.y));var l=this.canvasRenderBuffer.surface;if(r){this.canvasRenderer.renderGraphics(e,this.canvasRenderBuffer.context,!0),_.WebGLUtils.deleteWebGLTexture(l);var h=t.context.getWebGLTexture(l);t.context.drawTexture(h,0,0,i,n,0,0,i,n,l.width,l.height)}else{if(e.dirtyRender)this.canvasRenderer.renderGraphics(e,this.canvasRenderBuffer.context),(h=e.$texture)?t.context.updateTexture(h,l):(h=t.context.createTexture(l),e.$texture=h),e.$textureWidth=l.width,e.$textureHeight=l.height;var u=e.$textureWidth,d=e.$textureHeight;t.context.drawTexture(e.$texture,0,0,u,d,0,0,u/a,d/o,u,d)}(e.x||e.y)&&((e.dirtyRender||r)&&this.canvasRenderBuffer.context.translate(e.x,e.y),t.transform(1,0,0,1,-e.x,-e.y)),r||(e.dirtyRender=!1)}}},e.prototype.renderGroup=function(e,t){var r,i,n,a=e.matrix;if(a){r=_.Matrix.create();var o=t.globalMatrix;r.a=o.a,r.b=o.b,r.c=o.c,r.d=o.d,r.tx=o.tx,r.ty=o.ty,i=t.$offsetX,n=t.$offsetY,t.useOffset(),t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty)}for(var s=e.drawData,c=s.length,l=0;l<c;l++){var h=s[l];this.renderNode(h,t,t.$offsetX,t.$offsetY)}if(a){var u=t.globalMatrix;u.a=r.a,u.b=r.b,u.c=r.c,u.d=r.d,u.tx=r.tx,u.ty=r.ty,t.$offsetX=i,t.$offsetY=n,_.Matrix.release(r)}},e.prototype.createRenderBuffer=function(e,t){var r=L.pop();return r?r.resize(e,t):(r=new f.WebGLRenderBuffer(e,t)).$computeDrawCall=!1,r},e}(),f.WebGLRenderer=e,__reflect(e.prototype,"egret.web.WebGLRenderer",["egret.sys.SystemRenderer"])}(egret||(egret={})),function(e){var t,r;t=e.web||(e.web={}),r=function(){function e(e,t,r){this.gl=e,this.name=r.name,this.type=r.type,this.size=r.size,this.location=e.getAttribLocation(t,this.name),this.count=0,this.initCount(e),this.format=e.FLOAT,this.initFormat(e)}return e.prototype.initCount=function(e){switch(this.type){case 5126:case 5120:case 5121:case 5123:this.count=1;break;case 35664:this.count=2;break;case 35665:this.count=3;break;case 35666:this.count=4}},e.prototype.initFormat=function(e){switch(this.type){case 5126:case 35664:case 35665:case 35666:this.format=e.FLOAT;break;case 5121:this.format=e.UNSIGNED_BYTE;break;case 5123:this.format=e.UNSIGNED_SHORT;break;case 5120:this.format=e.BYTE}},e}(),t.EgretWebGLAttribute=r,__reflect(r.prototype,"egret.web.EgretWebGLAttribute")}(egret||(egret={})),function(e){!function(c){function s(e,t,r){var i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||(console.log("shader not compiled!"),console.log(e.getShaderInfoLog(i))),i}var e=function(){function n(e,t,r){var i,n,a,o;this.vshaderSource=t,this.fshaderSource=r,this.vertexShader=s(e,e.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=s(e,e.FRAGMENT_SHADER,this.fshaderSource),this.id=(i=e,n=this.vertexShader,a=this.fragmentShader,o=i.createProgram(),i.attachShader(o,n),i.attachShader(o,a),i.linkProgram(o),o),this.uniforms=function(e,t){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<i;n++){var a=e.getActiveUniform(t,n),o=a.name,s=new c.EgretWebGLUniform(e,t,a);r[o]=s}return r}(e,this.id),this.attributes=function(e,t){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var a=e.getActiveAttrib(t,n),o=a.name,s=new c.EgretWebGLAttribute(e,t,a);r[o]=s}return r}(e,this.id)}return n.getProgram=function(e,t,r,i){return this.programCache[i]||(this.programCache[i]=new n(e,t,r)),this.programCache[i]},n.deleteProgram=function(e,t,r,i){},n.programCache={},n}();c.EgretWebGLProgram=e,__reflect(e.prototype,"egret.web.EgretWebGLProgram")}(e.web||(e.web={}))}(egret||(egret={})),function(e){var t,r;t=e.web||(e.web={}),r=function(){function e(e,t,r){this.gl=e,this.name=r.name,this.type=r.type,this.size=r.size,this.location=e.getUniformLocation(t,this.name),this.setDefaultValue(),this.generateSetValue(),this.generateUpload()}return e.prototype.setDefaultValue=function(){switch(this.type){case 5126:case 35678:case 35680:case 35670:case 5124:this.value=0;break;case 35664:case 35671:case 35667:this.value=[0,0];break;case 35665:case 35672:case 35668:this.value=[0,0,0];break;case 35666:case 35673:case 35669:this.value=[0,0,0,0];break;case 35674:this.value=new Float32Array([1,0,0,1]);break;case 35675:this.value=new Float32Array([1,0,0,0,1,0,0,0,1]);break;case 35676:this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},e.prototype.generateSetValue=function(){switch(this.type){case 5126:case 35678:case 35680:case 35670:case 5124:this.setValue=function(e){var t=this.value!==e;this.value=e,t&&this.upload()};break;case 35664:case 35671:case 35667:this.setValue=function(e){var t=this.value[0]!==e.x||this.value[1]!==e.y;this.value[0]=e.x,this.value[1]=e.y,t&&this.upload()};break;case 35665:case 35672:case 35668:this.setValue=function(e){this.value[0]=e.x,this.value[1]=e.y,this.value[2]=e.z,this.upload()};break;case 35666:case 35673:case 35669:this.setValue=function(e){this.value[0]=e.x,this.value[1]=e.y,this.value[2]=e.z,this.value[3]=e.w,this.upload()};break;case 35674:case 35675:case 35676:this.setValue=function(e){this.value.set(e),this.upload()}}},e.prototype.generateUpload=function(){var t=this.gl,e=this.type,r=this.location;switch(e){case 5126:this.upload=function(){var e=this.value;t.uniform1f(r,e)};break;case 35664:this.upload=function(){var e=this.value;t.uniform2f(r,e[0],e[1])};break;case 35665:this.upload=function(){var e=this.value;t.uniform3f(r,e[0],e[1],e[2])};break;case 35666:this.upload=function(){var e=this.value;t.uniform4f(r,e[0],e[1],e[2],e[3])};break;case 35678:case 35680:case 35670:case 5124:this.upload=function(){var e=this.value;t.uniform1i(r,e)};break;case 35671:case 35667:this.upload=function(){var e=this.value;t.uniform2i(r,e[0],e[1])};break;case 35672:case 35668:this.upload=function(){var e=this.value;t.uniform3i(r,e[0],e[1],e[2])};break;case 35673:case 35669:this.upload=function(){var e=this.value;t.uniform4i(r,e[0],e[1],e[2],e[3])};break;case 35674:this.upload=function(){var e=this.value;t.uniformMatrix2fv(r,!1,e)};break;case 35675:this.upload=function(){var e=this.value;t.uniformMatrix3fv(r,!1,e)};break;case 35676:this.upload=function(){var e=this.value;t.uniformMatrix4fv(r,!1,e)}}},e}(),t.EgretWebGLUniform=r,__reflect(r.prototype,"egret.web.EgretWebGLUniform")}(egret||(egret={})),function(e){var t,r;t=e.web||(e.web={}),r=function(){function e(){}return e.blur_frag="precision mediump float;\r\nuniform vec2 blur;\r\nuniform sampler2D uSampler;\r\nvarying vec2 vTextureCoord;\r\nuniform vec2 uTextureSize;\r\nvoid main()\r\n{\r\n    const int sampleRadius = 5;\r\n    const int samples = sampleRadius * 2 + 1;\r\n    vec2 blurUv = blur / uTextureSize;\r\n    vec4 color = vec4(0, 0, 0, 0);\r\n    vec2 uv = vec2(0.0, 0.0);\r\n    blurUv /= float(sampleRadius);\r\n\r\n    for (int i = -sampleRadius; i <= sampleRadius; i++) {\r\n        uv.x = vTextureCoord.x + float(i) * blurUv.x;\r\n        uv.y = vTextureCoord.y + float(i) * blurUv.y;\r\n        color += texture2D(uSampler, uv);\r\n    }\r\n\r\n    color /= float(samples);\r\n    gl_FragColor = color;\r\n}",e.colorTransform_frag="precision mediump float;\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\nuniform mat4 matrix;\r\nuniform vec4 colorAdd;\r\nuniform sampler2D uSampler;\r\n\r\nvoid main(void) {\r\n    vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n    if(texColor.a > 0.) {\r\n        // 抵消预乘的alpha通道\r\n        texColor = vec4(texColor.rgb / texColor.a, texColor.a);\r\n    }\r\n    vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\r\n    gl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\r\n}",e.default_vert="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nattribute vec2 aColor;\r\n\r\nuniform vec2 projectionVector;\r\n// uniform vec2 offsetVector;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\n\r\nconst vec2 center = vec2(-1.0, 1.0);\r\n\r\nvoid main(void) {\r\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\r\n   vTextureCoord = aTextureCoord;\r\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\r\n}",e.glow_frag="precision highp float;\r\nvarying vec2 vTextureCoord;\r\n\r\nuniform sampler2D uSampler;\r\n\r\nuniform float dist;\r\nuniform float angle;\r\nuniform vec4 color;\r\nuniform float alpha;\r\nuniform float blurX;\r\nuniform float blurY;\r\n// uniform vec4 quality;\r\nuniform float strength;\r\nuniform float inner;\r\nuniform float knockout;\r\nuniform float hideObject;\r\n\r\nuniform vec2 uTextureSize;\r\n\r\nfloat random(vec2 scale)\r\n{\r\n    return fract(sin(dot(gl_FragCoord.xy, scale)) * 43758.5453);\r\n}\r\n\r\nvoid main(void) {\r\n    vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);\r\n    // TODO 自动调节采样次数？\r\n    const float linearSamplingTimes = 7.0;\r\n    const float circleSamplingTimes = 12.0;\r\n    vec4 ownColor = texture2D(uSampler, vTextureCoord);\r\n    vec4 curColor;\r\n    float totalAlpha = 0.0;\r\n    float maxTotalAlpha = 0.0;\r\n    float curDistanceX = 0.0;\r\n    float curDistanceY = 0.0;\r\n    float offsetX = dist * cos(angle) * px.x;\r\n    float offsetY = dist * sin(angle) * px.y;\r\n\r\n    const float PI = 3.14159265358979323846264;\r\n    float cosAngle;\r\n    float sinAngle;\r\n    float offset = PI * 2.0 / circleSamplingTimes * random(vec2(12.9898, 78.233));\r\n    float stepX = blurX * px.x / linearSamplingTimes;\r\n    float stepY = blurY * px.y / linearSamplingTimes;\r\n    for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {\r\n        cosAngle = cos(a + offset);\r\n        sinAngle = sin(a + offset);\r\n        for (float i = 1.0; i <= linearSamplingTimes; i++) {\r\n            curDistanceX = i * stepX * cosAngle;\r\n            curDistanceY = i * stepY * sinAngle;\r\n            if (vTextureCoord.x + curDistanceX - offsetX >= 0.0 && vTextureCoord.y + curDistanceY + offsetY <= 1.0){\r\n                curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));\r\n                totalAlpha += (linearSamplingTimes - i) * curColor.a;\r\n            }\r\n            maxTotalAlpha += (linearSamplingTimes - i);\r\n        }\r\n    }\r\n\r\n    ownColor.a = max(ownColor.a, 0.0001);\r\n    ownColor.rgb = ownColor.rgb / ownColor.a;\r\n\r\n    float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);\r\n    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;\r\n\r\n    ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);\r\n    vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));\r\n    vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));\r\n    float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);\r\n    gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);\r\n}",e.primitive_frag="precision lowp float;\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\n\r\nvoid main(void) {\r\n    gl_FragColor = vColor;\r\n}",e.texture_frag="precision lowp float;\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\nuniform sampler2D uSampler;\r\n\r\nvoid main(void) {\r\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\r\n}",e}(),t.EgretShaderLib=r,__reflect(r.prototype,"egret.web.EgretShaderLib")}(egret||(egret={}));